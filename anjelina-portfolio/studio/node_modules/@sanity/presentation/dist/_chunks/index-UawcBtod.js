import{jsx as e,jsxs as n,Fragment as t}from"react/jsx-runtime";import{createContext as i,useState as o,useEffect as r,useContext as a,useCallback as s,createElement as c,useRef as l,useMemo as d,lazy as u,Suspense as p}from"react";import{useDocumentStore as m,defineDocumentFieldAction as h,useWorkspace as f,pathToString as v,isRecord as y,getPublishedId as g,definePlugin as w,isDocumentSchemaType as b}from"sanity";import{ComposeIcon as P,ChevronRightIcon as x,DesktopIcon as T,InfoOutlineIcon as I,WarningOutlineIcon as j,ErrorOutlineIcon as z,MasterDetailIcon as _}from"@sanity/icons";import{Card as S,Flex as O,Box as A,Text as D,Stack as k,rem as B}from"@sanity/ui";import C from"styled-components";import{useIntentLink as E,useRouter as H,encodeJsonParams as L,route as N}from"sanity/router";import{isObservable as U,of as M}from"rxjs";import{uuid as R}from"@sanity/uuid";const q=P,F="presentation",G="Presentation",J="sanity/structure/comments",K="presentation",Q=3e3,V="2023-10-16",W=1e3,X=100,Y=2048,Z=i(null),$={locations:[]};const ee={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"},ne={positive:I,caution:j,critical:z};function te(i){const{documentId:l,options:d,schemaType:u,showPresentationTitle:p}=i,h=a(Z),{message:f,locations:v,tone:y}=function(e){const{id:n,locate:t,type:i}=e,a=m(),[s,c]=o($);return r((()=>{if(!t)return;const e=t({id:n,type:i},{documentStore:a}),o=(U(e)?e:M(e)).subscribe((e=>c(e||$)));return()=>o.unsubscribe()}),[a,n,t,i]),s}({id:l,locate:d.locate,type:u.name}),g=(null==v?void 0:v.length)||0,[w,b]=o(!1),P=s((()=>b((e=>!e))),[]),T=f||(g?n(t,{children:["Used on ",ee[g]||g," ",e(t,1===g?{children:"page"}:{children:"pages"})]}):null);return 0!==g||T?e(S,{padding:1,radius:3,border:!0,tone:y,children:n("div",{style:{margin:-1},children:[!v&&n(O,{align:"flex-start",gap:3,padding:3,children:[y&&e(A,{flex:"none",children:e(D,{size:1,children:c(ne[y])})}),e(A,{flex:1,children:n(D,{size:1,weight:"medium",children:[p&&n(t,{children:[d.title||G," · "]}),T]})})]}),v&&n(t,{children:[e(S,{as:"button",onClick:P,padding:3,radius:2,tone:"inherit",children:n(O,{gap:3,children:[e(A,{flex:"none",children:e(D,{size:1,children:e(x,{style:{transform:"rotate(".concat(w?"90deg":0,")"),transition:"transform 100ms ease-in-out"}})})}),e(A,{flex:1,children:n(D,{size:1,weight:"medium",children:[p&&n(t,{children:[d.title||G," · "]}),T]})})]})}),e(k,{hidden:!w,marginTop:1,space:1,children:v.map(((n,t)=>e(ie,{active:(d.name||F)===(null==h?void 0:h.name)&&n.href===(null==h?void 0:h.params.preview),documentId:l,documentType:u.name,node:n,toolName:d.name||F},t)))})]})]})}):null}function ie(t){const{documentId:i,documentType:o,node:r,active:l,toolName:d}=t,u=a(Z),p=null==u?void 0:u.navigate,m=E({intent:"edit",params:{id:i,type:o,mode:"presentation",presentation:d,...null==u?void 0:u.deskParams,preview:r.href}}),h=s((()=>{null==p||p({},{preview:r.href})}),[r.href,p]);return c(S,{...u?{}:m,as:u?"button":"a",key:r.href,onClick:h,padding:3,radius:2,pressed:l,tone:"inherit"},n(O,{gap:3,children:[e(A,{flex:"none",children:e(D,{size:1,children:e(T,{})})}),n(k,{flex:1,space:2,children:[e(D,{size:1,weight:"medium",children:r.title}),e(D,{muted:!0,size:1,textOverflow:"ellipsis",children:r.href})]})]}))}const oe=i(null);var re,ae=Object.freeze,se=Object.defineProperty;const ce=C(k)(re||(re=ae(se(le=["\n  min-height: ",";\n\n  & + &:empty {\n    display: none;\n  }\n"],"raw",{value:ae(de||le.slice())}))),B(42));var le,de;function ue(n){var t;const{documentId:i,options:o,schemaType:r}=n,s=a(oe);if(s&&s.options[0]!==o)return e(ce,{marginBottom:5,space:5});const c=(null==(t=null==s?void 0:s.options)?void 0:t.length)||0;return e(ce,{marginBottom:5,space:5,children:e(k,{space:2,children:null==s?void 0:s.options.map(((n,t)=>e(te,{documentId:i,options:n,schemaType:r,showPresentationTitle:c>1},t)))})})}function pe(n){const{children:t,options:i}=n,c=a(oe),u=null==c?void 0:c.register,[p,m]=o((()=>[])),h=s((e=>u?u(e):(m((n=>[e].concat(n))),()=>{m((n=>n.filter((n=>n!==e))))})),[u]),f=l(h);f.current=h;const v=d((()=>({options:(null==c?void 0:c.options)||p,register:h})),[p,c,h]);return r((()=>f.current(i)),[i]),e(oe.Provider,{value:v,children:t})}const me=h({name:"presentation/openInStructure",useAction({documentId:e,documentType:n,path:t}){const i=f(),{navigateIntent:o}=H(),r=a(Z),s=d((()=>function(e,n,t){var i;const o=e.map((e=>{var i;return{tool:e,match:null==(i=e.canHandleIntent)?void 0:i.call(e,"edit",{id:n,type:t,mode:"structure"},{})}})),r=o.filter((e=>y(e.match)&&e.match.mode));if(r.length>0)return r[0].tool;const a=o.filter((e=>e.match));return null==(i=a[0])?void 0:i.tool}(i.tools,e,n)),[e,n,i.tools]);return{type:"action",hidden:!r||t.length>0||!s,icon:(null==s?void 0:s.icon)||_,title:"Open in ".concat((null==s?void 0:s.title)||"Structure"),onAction(){o("edit",{id:e,type:n,mode:"structure",path:v(t)})},renderAsButton:!0}}});function he(e,n,t,i){const{id:o,mode:r,path:a,presentation:s,type:c,...l}=n;return"edit"===e&&o?{type:c||"*",id:g(o),path:a,_searchParams:Object.entries(l)}:"create"===e?(l.preview=l.preview||new URLSearchParams(window.location.search).get("preview")||"/",i&&"object"==typeof i&&(l.templateParams=L(i)),{type:c||"*",id:o||R(),_searchParams:Object.entries(l)}):{intent:e,params:n,payload:i}}const fe=N.create("/",{__unsafe_disableScopedSearchParams:!0},[N.intents("/intent"),N.create(":type",[N.create(":id",[N.create(":path")])])]),ve=u((()=>import("./PresentationTool-Brzzh4yZ.js"))),ye=u((()=>import("./BroadcastDisplayedDocument-h9bbKlyj.js"))),ge=w((t=>{const i=t.name||F;return{document:{unstable_fieldActions:e=>[...e.filter((e=>e.name!==me.name)),me]},form:{components:{input:function(i){const o=i.value,r=(null==o?void 0:o._id)?g(null==o?void 0:o._id):void 0;return b(i.schemaType)?n(pe,{options:t,children:[t.locate&&r&&e(ue,{documentId:r,options:t,schemaType:i.schemaType}),i.renderDefault(i),e(p,{children:e(ye,{value:o})},"broadcast-displayed-document")]}):i.renderDefault(i)}}},tools:[{icon:t.icon||q,name:i,title:t.title,component:ve,options:t,canHandleIntent:(e,n)=>"create"===e?function(e){return"type"in e&&(!("presentation"in e)||e.presentation===i)&&(!("template"in e)||{template:!0})}(n):"edit"===e&&function(e){return"type"in e&&"id"in e&&(!("presentation"in e)||e.presentation===i)&&(!("mode"in e)||{mode:e.mode===K})}(n),getIntentState:he,router:fe}]}})),we=i(null);function be(){const e=a(we);if(!e)throw new Error("Presentation navigate context is missing");return e}const Pe=i(null);function xe(){const e=a(Pe);if(!e)throw new Error("Presentation params context is missing");return e}export{V as A,J as C,F as D,K as E,Y as L,Q as M,Z as P,we as a,Pe as b,W as c,X as d,xe as e,ge as p,be as u};//# sourceMappingURL=index-UawcBtod.js.map
