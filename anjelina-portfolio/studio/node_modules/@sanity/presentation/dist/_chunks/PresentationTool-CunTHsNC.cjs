"use strict";var e=require("react/jsx-runtime"),t=require("@sanity/client/csm"),n=require("@sanity/ui"),r=require("react"),i=require("sanity"),o=require("sanity/router"),a=require("sanity/structure"),s=require("styled-components"),c=require("./index-CxnS6dlH.cjs"),l=require("./DisplayedDocumentBroadcaster-DW4Jb8eg.cjs"),d=require("@sanity/icons"),u=require("@sanity/preview-url-secret/create-secret"),p=require("@sanity/preview-url-secret/without-secret-search-params"),f=require("framer-motion"),h=require("fast-deep-equal"),m=require("@sanity/preview-url-secret/define-preview-url"),v=require("suspend-react");function g(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var x=g(s),y=g(h);let b;const w=new Uint8Array(16);function j(){if(!b&&(b="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!b))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return b(w)}const k=[];for(let e=0;e<256;++e)k.push((e+256).toString(16).slice(1));var P={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function S(e,t,n){if(P.randomUUID&&!t&&!e)return P.randomUUID();const r=(e=e||{}).random||(e.rng||j)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return k[e[t+0]]+k[e[t+1]]+k[e[t+2]]+k[e[t+3]]+"-"+k[e[t+4]]+k[e[t+5]]+"-"+k[e[t+6]]+k[e[t+7]]+"-"+k[e[t+8]]+k[e[t+9]]+"-"+k[e[t+10]]+k[e[t+11]]+k[e[t+12]]+k[e[t+13]]+k[e[t+14]]+k[e[t+15]]}(r)}const E=1e3,C=1e3,I=500,z=["handshake/syn","handshake/syn-ack","handshake/ack"],T=e=>z.some((t=>t===e)),R=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function O(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(T(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),l(e,"handshake/ack",{id:e.id}))}}const o=t=>{var r,i,o;const{data:a}=t;if(!T(a.type)&&n.find((e=>e.id===a.connectionId))){const t=n.find((e=>e.config.id===a.from));if(t){const n=[a.type,a.data];null==(i=(r=t.config).onEvent)||i.call(r,...n),null==(o=e.onEvent)||o.call(e,...n),d(t,"channel/response",{responseTo:a.id},!1)}}};function a(t){var r;if(R(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;null==(r=n.find((t=>t.config.id===e.from)))||r.handler(t)}}function s(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){var a,c,u;t.status=n,null==(c=(a=t.config).onStatusUpdate)||c.call(a,n,t.config.id),null==(u=e.onStatusUpdate)||u.call(e,n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,s(t),function(e){e.id=S(),e.interval=window.setInterval((()=>{l(e,"handshake/syn",{id:e.id})}),I)}(t)):"connected"===n?(t.handler=o,r(t),function(e){if(s(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:C;e.heartbeat=window.setInterval((()=>{d(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{d(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),s(t))}function l(n,r,i){if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:S(),to:n.config.id,type:r};try{null==t||t.postMessage(o,{targetOrigin:"*"})}catch(t){throw new Error("Failed to postMessage '".concat(o.id,"' on '").concat(e.id,"'"))}}function d(n,r,i,o=!0){const a=S();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const s={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:a,to:n.config.id,type:r};if(o){const t=setTimeout((()=>{s.connectionId===n.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn("Received no response to message '".concat(s.type,"' on client '").concat(e.id,"' (ID: '").concat(s.id,"').")))}),E),o=e=>{var n;const{data:r}=e;"channel/response"===r.type&&(null==(n=r.data)?void 0:n.responseTo)&&r.data.responseTo===s.id&&(window.removeEventListener("message",o,!1),clearTimeout(t))};window.addEventListener("message",o,!1)}try{null==t||t.postMessage(s,{targetOrigin:e.targetOrigin})}catch(t){throw new Error("Failed to postMessage '".concat(s.id,"' on client '").concat(e.id,"'"))}}return window.addEventListener("message",a,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(d(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",a,!1),n.forEach((e=>{s(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");d(i,t,r)}))}}}const L=/^([A-Za-z]+):([0-9]+)$/,D=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,M=/^([A-Za-z]+):([a-z0-9]+)$/;const U={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function A(e){return"Alt"===e.key}function F(t){const{children:r,message:i,onRetry:o,onContinueAnyway:a,...s}=t,c=e.jsx(n.Button,{fontSize:1,mode:"ghost",onClick:o,text:"Retry"}),l=e.jsx(n.Button,{fontSize:1,mode:"ghost",tone:"critical",onClick:a,text:"Continue anyway"});return e.jsx(n.Card,{height:"fill",...s,children:e.jsx(n.Flex,{align:"center",height:"fill",justify:"center",children:e.jsx(n.Container,{padding:4,sizing:"border",width:0,children:e.jsxs(n.Stack,{space:4,children:[e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Text,{size:1,weight:"semibold",children:"An error occured"}),e.jsx(n.Text,{muted:!0,size:1,children:i})]}),r,o&&a?e.jsxs(n.Inline,{space:2,children:[c,l]}):o?e.jsx(n.Box,{children:c}):a?e.jsx(n.Box,{children:l}):null]})})})})}function B(){const e=r.useContext(c.P);if(!e)throw new Error("Presentation context is missing");return e}function W(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>"".concat(e,"=").concat(t))).join("&");return t.length?"?".concat(t):""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const _=r.forwardRef((function(t,n){const{deskParams:r,params:i}=B();return e.jsx(o.StateLink,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),q=r.forwardRef((function(t,n){const{documentId:r,documentType:i,parentRefPath:a,template:s,...c}=t;return e.jsx(o.StateLink,{...c,ref:n,state:{id:r,type:i},title:void 0})}));function N(t){const{children:n,params:s,onDeskParams:c,previewUrl:l,refs:d}=t,{state:u,resolvePathFromState:p}=o.useRouter(),f=i.useUnique(Object.fromEntries(u._searchParams||[])),h=r.useCallback((e=>{const t=p(u),n=W({...f,...e});return"".concat(t).concat(n)}),[p,f,u]),m=r.useMemo((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:s,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,a=null==d?void 0:d.find((e=>e._id===n||i.getPublishedId(e._id)===n));return a?e.jsx(o.StateLink,{...r,state:{id:n,type:a._type,_searchParams:Object.entries({preview:l})}}):e.jsx("div",{...r})},BackLink:_,ReferenceChildLink:q,ParameterizedLink:()=>e.jsx(e.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{var t;c({...e,inspect:null!=(t=e.inspect)?t:void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:h})),[h,c,s,l,d]);return e.jsx(a.PaneRouterContext.Provider,{value:m,children:n})}var $,V,K,G=Object.freeze,J=Object.defineProperty,H=(e,t)=>G(J(e,"raw",{value:G(t||e.slice())}));const X=x.default(a.PaneLayout)($||($=H(["\n  height: 100%;\n"]))),Z=x.default(n.Flex)(V||(V=H(["\n  & > div {\n    min-width: none !important;\n    max-width: none !important;\n  }\n"]))),Q=x.default(n.Code)(K||(K=H(["\n  white-space: pre-wrap;\n"])));function Y(t){const{onDeskParams:i,previewUrl:o,refs:s}=t,{devMode:c}=B(),l=r.useMemo((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:s.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[s]),[d,u]=r.useState(null),p=r.useCallback((()=>u(null)),[]),[f]=r.useState((()=>({})));return r.useEffect((()=>u(null)),[s]),d?e.jsx(F,{flex:1,message:"Could not render the document list",onRetry:p,children:c&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(Q,{size:1,children:d.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:u,children:e.jsx(X,{children:e.jsx(a.StructureToolProvider,{children:e.jsx(N,{params:f,onDeskParams:i,previewUrl:o,refs:s,children:e.jsx(Z,{direction:"column",flex:1,children:e.jsx(a.DocumentListPane,{index:0,itemId:"$root",pane:l,paneKey:"$root"})})})})})})}var ee,te=Object.freeze,ne=Object.defineProperty;const re=x.default(n.Code)(ee||(ee=te(ne(ie=["\n  white-space: pre-wrap;\n"],"raw",{value:te(oe||ie.slice())}))));var ie,oe;function ae(t){const{documentId:i,documentType:s,params:c,onDeskParams:l,onFocusPath:d}=t,{template:u,templateParams:p}=c,{devMode:f}=B(),h=r.useMemo((()=>({id:i,options:{id:i,type:s,template:u,templateParameters:o.decodeJsonParams(p)},title:"",type:"document"})),[i,s,u,p]),[m,v]=r.useState(null),g=r.useCallback((()=>v(null)),[]);r.useEffect((()=>{v(null)}),[i,s,c]);const{setLayoutCollapsed:x}=a.useStructureTool(),y=r.useCallback((()=>x(!0)),[x]),b=r.useCallback((()=>x(!1)),[x]);return m?e.jsx(F,{flex:1,message:"Could not render the document editor",onRetry:g,children:f&&e.jsx(n.Card,{overflow:"auto",padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Error message"}),e.jsx(re,{size:1,children:m.error.message})]})})}):e.jsx(n.ErrorBoundary,{onCatch:v,children:e.jsx(a.PaneLayout,{style:{height:"100%"},onExpand:b,onCollapse:y,children:e.jsx(N,{onDeskParams:l,params:c,children:e.jsx(a.DocumentPane,{paneKey:"document",index:1,itemId:"document",pane:h,onFocusPath:d})})})})}function se(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:s}=t;return e.jsx(a.StructureToolProvider,{children:e.jsx(ae,{documentId:r,documentType:i,params:n,onDeskParams:o,onFocusPath:s})})}function ce(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,previewUrl:s,refs:c}=t;return r&&i?e.jsx(se,{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a}):e.jsx(Y,{onDeskParams:o,previewUrl:s,refs:c})}const le=r.createContext(null);le.displayName="PanelsContext";var de,ue=Object.freeze,pe=Object.defineProperty;const fe=x.default.div(de||(de=((e,t)=>ue(pe(e,"raw",{value:ue(t||e.slice())})))(["\n  overflow: hidden;\n  flex-basis: 0;\n  flex-shrink: 1;\n"]))),he=function({children:t,defaultSize:n=null,id:i,minWidth:o,maxWidth:a,order:s=0}){const c=r.useContext(le);if(null===c)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:l,registerElement:d,unregisterElement:u}=c,p=l(i);return r.useLayoutEffect((()=>(d(i,{id:i,type:"panel",defaultSize:n,maxWidth:null!=a?a:null,minWidth:null!=o?o:0,order:s}),()=>{u(i)})),[i,n,s,a,o,d,u]),e.jsx(fe,{style:p,children:t})};var me,ve,ge=Object.freeze,xe=Object.defineProperty,ye=(e,t)=>ge(xe(e,"raw",{value:ge(t||e.slice())}));const be=x.default.div(me||(me=ye(["\n  position: relative;\n"]))),we=x.default.div(ve||(ve=ye(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: -5px;\n  width: 9px;\n  z-index: 10;\n  cursor: ",";\n\n  /* Border */\n  & > span:nth-child(1) {\n    display: block;\n    border-left: 1px solid var(--card-border-color);\n    position: absolute;\n    top: 0;\n    left: 4px;\n    bottom: 0;\n    transition: opacity 200ms;\n  }\n\n  ","\n"])),(({$disabled:e})=>e?"auto":"ew-resize"),(({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  ")),je=function({id:t,order:n,disabled:i=!1}){const o=r.useRef(null),a=r.useContext(le);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const s=function(e){return r.useRef(e||S()).current}(t),{activeResizer:c,drag:l,startDragging:d,stopDragging:u,registerElement:p,unregisterElement:f}=a,h=c===s;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const m=r.useCallback((e=>{d(s,e.nativeEvent)}),[s,d]),v=r.useCallback((e=>{l(s,e)}),[s,l]),g=r.useCallback((()=>{o.current.blur(),u()}),[u]);return r.useEffect((()=>{if(h&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,h,v,g]),r.useLayoutEffect((()=>(p(s,{id:s,order:n,type:"resizer",el:o}),()=>{f(s)})),[s,n,p,f]),e.jsx(be,{onMouseDown:m,ref:o,children:e.jsxs(we,{$disabled:i,children:[e.jsx("span",{}),e.jsx("span",{})]})})};function ke(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const Pe="presentation/panels",Se=()=>JSON.parse(localStorage.getItem(Pe)||"{}"),Ee=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function Ce(){return r.useMemo((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(Pe,JSON.stringify(e))})({...Se(),[Ee(e)]:t})};return{get:e=>Se()[Ee(e)],set:e,setDebounced:ke(e,100)}}),[])}function Ie(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,a=i/n*100;return Math.min(o,Math.max(a,t))}function ze(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function Te(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Re(e){return"panel"===e.type}function Oe(e){return"resizer"===e.type}function Le(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function De(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],a=i[t],s=Ie(r,a,n);a!=s&&(o+=a-s,i[t]=s)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:a,minWidth:s}=r;s=s/n*100,null!=a&&(a=a/n*100);const c=Math.min(null!=a?a:100,Math.max(s,i[t]+o));if(c!==i[t]&&(o-=c-i[t],i[t]=c,"0.000"===Math.abs(o).toFixed(3)))break}return i}var Me,Ue=Object.freeze,Ae=Object.defineProperty;const Fe=x.default.div(Me||(Me=((e,t)=>Ue(Ae(e,"raw",{value:Ue(t||e.slice())})))(["\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  overflow: hidden;\n  width: 100%;\n"]))),Be=function({children:t}){const n=r.useRef(null),[i,o]=r.useState(new Map),a=r.useMemo((()=>Le(i).filter(Re)),[i]),[s,c]=r.useState([]),[l,d]=r.useState(null),u=r.useRef({elements:i,panels:a,widths:s}),p=r.useCallback((e=>({flexGrow:ze(a,e,s),pointerEvents:null===l?void 0:"none"})),[l,a,s]),f=r.useCallback(((e,t)=>{o((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=r.useCallback((e=>{o((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),m=r.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),v=r.useCallback(((e,t)=>{const n=Le(i),r=n.findIndex((t=>t.id===e)),o=i.get(e);if(!o||!Oe(o))return;const a=o.el.current;a&&(m.current={resizerIndex:r,panelBefore:n.reduce(((e,t,n)=>Re(t)&&n<r?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Re(t)&&n>r?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:Te(t,a),resizerRect:a.getBoundingClientRect(),widths:u.current.widths},d(e))}),[i]),g=r.useCallback((()=>{d(null)}),[]),x=r.useCallback(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:r,dragOffset:o,panelBefore:a,panelAfter:s,resizerRect:l}=m.current;if(null==a||null==s)return;const d=i.get(e);if(!d||!Oe(d))return;const p=d.el.current;if(!p)return;const f=Te(t,p,o,l);if(0===f)return;const{widths:h}=u.current,v=function(e,t,n,r,i,o){const{panels:a,widths:s}=i,{widths:c}=o,l=c||s,d=[...l];{const i=e<0?r:n,o=l[a.findIndex((e=>e.id===i.id))],s=Ie(i,o+Math.abs(e),t);if(o===s)return l;e=e<0?o-s:s-o}let u=0,p=e<0?n:r,f=a.findIndex((e=>e.id===p.id));for(;;){const n=a[f],r=l[f],i=Ie(n,r-(Math.abs(e)-Math.abs(u)),t);if(r!==i&&(u+=r-i,d[f]=i,u.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--f<0)break}else if(++f>=a.length)break}return 0===u?l:(p=e<0?r:n,f=a.findIndex((e=>e.id===p.id)),d[f]=l[f]+u,d)}(f/n.current.getBoundingClientRect().width*100,r,a,s,u.current,m.current),g=h.some(((e,t)=>e!==v[t]));g&&c(v)}),[i]);r.useLayoutEffect((()=>{u.current.elements=i,u.current.panels=a,u.current.widths=s}),[i,a,s]);const y=Ce();r.useLayoutEffect((()=>{const{widths:e}=u.current;if(e.length===a.length)return;const t=y.get(a);if(t){const e=De(a,t,window.innerWidth);return void c(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(a);c(n)}),[y,a]),r.useEffect((()=>{s.length&&y.setDebounced(a,s)}),[y,a,s]),r.useLayoutEffect((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=u.current,n=De(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&c(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const b=r.useMemo((()=>({activeResizer:l,drag:x,getPanelStyle:p,registerElement:f,startDragging:v,stopDragging:g,unregisterElement:h})),[l,x,p,f,v,g,h]);return e.jsx(le.Provider,{value:b,children:e.jsx(Fe,{ref:n,children:t})})},We=function(t){const{children:n,navigate:i}=t,o=r.useCallback(((e,t=void 0)=>{i(t||{},e?{preview:e}:{})}),[i]);return e.jsx(c.a.Provider,{value:o,children:n})};function _e(t){const{unstable_navigator:n}=t,i=!!(null==n?void 0:n.component),[o,a]=function(e,t){const[n,i]=r.useState((()=>{var n;return JSON.parse(null!=(n=localStorage.getItem(e))?n:JSON.stringify(t))}));return r.useEffect((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,i]}("presentation/navigator",i),s=!!i&&o,c=r.useMemo((()=>{if(i)return()=>a((e=>!e))}),[i,a]),l=r.useCallback((function(){return e.jsx(e.Fragment,{children:s&&e.jsx(qe,{...n})})}),[s,n]);return[{navigatorEnabled:s,toggleNavigator:c},l]}const qe=r.memo((function(t){const{minWidth:n,maxWidth:r,component:i}=t,o=null!=n&&null!=r&&n===r;return e.jsxs(e.Fragment,{children:[e.jsx(he,{id:"navigator",minWidth:n,maxWidth:r,order:1,children:e.jsx(i,{})}),e.jsx(je,{order:2,disabled:o})]})})),Ne=function(t){const{children:n,params:i}=t,o=r.useMemo((()=>i),[i]);return e.jsx(c.b.Provider,{value:o,children:n})},$e=function(t){const{children:n,deskParams:i,devMode:o,name:a,navigate:s,params:l}=t,d=r.useMemo((()=>({deskParams:i,devMode:o,name:a,navigate:s,params:l})),[i,o,a,s,l]);return e.jsx(c.P.Provider,{value:d,children:n})};var Ve,Ke,Ge,Je,He=class extends Error{issues;constructor(e){super(e[0].message),this.name="ValiError",this.issues=e}};function Xe(e,t){return Array.isArray(e)?[void 0,e]:[e,t]}function Ze(e,t,n,r){const i=e.message??function(e,t){return Je?.get(e)?.get(t)}(t,r.lang)??("type"===e.type?(o=r.lang,Ge?.get(o)):null)??n?.message??function(e){return Ke?.get(e)}(r.lang)??r.message;var o;return"function"==typeof i?i(r):i}function Qe(e,t,n){return{typed:e,output:t,issues:n}}function Ye(e){let t=typeof e;return"object"===t&&(t=e?Object.getPrototypeOf(e).constructor.name:"null"),"string"===t?`"${e}"`:"number"===t||"bigint"===t||"boolean"===t?`${e}`:t}function et(e,t,n){const r=n.received??Ye(n.input),i={reason:e.type,context:n.context.type,expected:n.context.expects,received:r,message:`Invalid ${n.label}: ${n.context.expects?`Expected ${n.context.expects} but r`:"R"}eceived ${r}`,input:n.input,requirement:n.context.requirement,path:n.path,lang:t?.lang,abortEarly:t?.abortEarly,abortPipeEarly:t?.abortPipeEarly,skipPipe:t?.skipPipe};return i.message=Ze(n.context,n.reference,t,i),i}function tt(e,t,n,r){if(e.pipe&&!n?.skipPipe)for(const i of e.pipe){const o=i._parse(t);if(o.issues){for(const t of o.issues){const i=et(e,n,t);r?r.push(i):r=[i]}if(n?.abortEarly||n?.abortPipeEarly)break}else t=o.output}return Qe(!0,t,r)}function nt(e,t,n,r,i){const o=Ye(n),a=i?.expected??e.expects,s={reason:i?.reason??"type",context:e.type,expected:a,received:o,message:`Invalid type: Expected ${a} but received ${o}`,input:n,path:i?.path,issues:i?.issues,lang:r?.lang,abortEarly:r?.abortEarly,abortPipeEarly:r?.abortPipeEarly,skipPipe:r?.skipPipe};return s.message=Ze(e,t,r,s),{typed:!1,output:n,issues:[s]}}function rt(e,t){return{...e,fallback:t,_parse(t,n){const r=e._parse(t,n);return r.issues?Qe(!0,function(e,t){return"function"==typeof e.fallback?e.fallback(t):e.fallback}(this,{input:t,issues:r.issues})):r}}}function it(e,t,n,r){const[i,o,a]=function(e,t,n){if(!e||"object"==typeof e&&!Array.isArray(e)){const[r,i]=Xe(t,n);return[e,r,i]}const[r,i]=Xe(e,t);return[void 0,r,i]}(t,n,r);let s;return{type:"object",expects:"Object",async:!1,entries:e,rest:i,message:o,pipe:a,_parse(e,t){if(e&&"object"==typeof e){s=s??Object.entries(this.entries);let n,r=!0;const i={};for(const[o,a]of s){const s=e[o],c=a._parse(s,t);if(c.issues){const i={type:"object",origin:"value",input:e,key:o,value:s};for(const e of c.issues)e.path?e.path.unshift(i):e.path=[i],n?.push(e);if(n||(n=c.issues),t?.abortEarly){r=!1;break}}c.typed||(r=!1),(void 0!==c.output||o in e)&&(i[o]=c.output)}if(this.rest&&(!t?.abortEarly||!n))for(const o in e)if(!(o in this.entries)){const a=e[o],s=this.rest._parse(a,t);if(s.issues){const i={type:"object",origin:"value",input:e,key:o,value:a};for(const e of s.issues)e.path?e.path.unshift(i):e.path=[i],n?.push(e);if(n||(n=s.issues),t?.abortEarly){r=!1;break}}s.typed||(r=!1),i[o]=s.output}return r?tt(this,i,t,n):Qe(!1,i,n)}return nt(this,it,e,t)}}}function ot(e,t){return{type:"picklist",expects:e.map(Ye).join(" | "),async:!1,options:e,message:t,_parse(e,t){return this.options.includes(e)?Qe(!0,e):nt(this,ot,e,t)}}}function at(e,t,n){const r=e._parse(t,function(e){return{lang:e?.lang??Ve?.lang,message:e?.message,abortEarly:e?.abortEarly??Ve?.abortEarly,abortPipeEarly:e?.abortPipeEarly??Ve?.abortPipeEarly,skipPipe:e?.skipPipe??Ve?.skipPipe}}(n));if(r.issues)throw new He(r.issues);return r.output}const st="ACTION_PERSPECTIVE",ct="ACTION_VIEWPORT",lt="ACTION_VISUAL_EDITING_OVERLAYS_TOGGLE",dt=(e,t)=>{switch(t.type){case st:return{...e,perspective:at(pt,t.perspective)};case ct:return{...e,viewport:at(ft,t.viewport)};case lt:return ut(e,t);default:return e}},ut=(e,t)=>e.visualEditing.overlays.enabled===t.enabled?e:{...e,visualEditing:{...e.visualEditing,overlays:{...e.visualEditing.overlays,enabled:t.enabled}}},pt=rt(ot(["published","previewDrafts"]),"previewDrafts"),ft=rt(ot(["desktop","mobile"]),"desktop"),ht=it({perspective:pt,viewport:ft,visualEditing:it({overlays:it({enabled:function e(t,n){const[r,i]=Xe(t,n);return{type:"boolean",expects:"boolean",async:!1,message:r,pipe:i,_parse(t,n){return"boolean"==typeof t?tt(this,t,n):nt(this,e,t,n)}}}()})})}),mt={perspective:"previewDrafts",viewport:"desktop",visualEditing:{overlays:{enabled:!1}}};function vt(e){return at(ht,{...mt,...e})}var gt,xt=Object.freeze,yt=Object.defineProperty;const bt=f.motion(x.default.iframe(gt||(gt=((e,t)=>xt(yt(e,"raw",{value:xt(t||e.slice())})))(["\n  border: 0;\n  max-height: 100%;\n  width: 100%;\n  display: block;\n"])))),wt=function(t){var o;const{basePath:a="/"}=(null==(o=i.useActiveWorkspace())?void 0:o.activeWorkspace)||{},{fontSize:s=1,onChange:c,origin:l,padding:u=3,value:p}=t,f=r.useRef(null),[h,m]=r.useState(void 0),[v,g]=r.useState(void 0),x=r.useCallback((e=>{m(e.currentTarget.value)}),[]),y=r.useCallback((e=>{var t;if("Enter"===e.key){if(void 0===h)return;const e=h.startsWith("/")||""===h?"".concat(l).concat(h):h;if(!e.startsWith(l+"/")&&e!==l)return void g("URL must start with ".concat(l));if(!l&&(e.startsWith("".concat(a,"/"))||e===a))return void g("URL can't have the same base path as the Studio ".concat(a));const n=e===l?l+"/":e;g(void 0),m(void 0),c(n.slice(l.length)),null==(t=f.current)||t.blur()}"Escape"===e.key&&(g(void 0),m(void 0))}),[a,c,l,h]),b=r.useCallback((()=>{g(void 0),m(void 0)}),[]);r.useEffect((()=>{g(void 0),m(void 0)}),[l,p]);const w=r.useMemo((()=>({icon:d.ResetIcon})),[]);return e.jsx(e.Fragment,{children:e.jsx(n.TextInput,{clearButton:v?w:void 0,customValidity:v,fontSize:s,onBlur:b,onClear:()=>{g(void 0),m(l+p)},onChange:x,onKeyDownCapture:y,padding:u,style:{zIndex:1},radius:2,ref:f,space:u,value:void 0===h?"".concat(l).concat(p):h})})};var jt,kt=Object.freeze,Pt=Object.defineProperty;const St=f.motion(n.Flex),Et=x.default(n.Switch)(jt||(jt=((e,t)=>kt(Pt(e,"raw",{value:kt(t||e.slice())})))(["\n  & > span {\n    width: 21px;\n    height: 13px;\n    overflow: hidden;\n\n    & > span:nth-child(1) {\n      width: 21px;\n      height: 13px;\n    }\n\n    & > span:nth-child(2) {\n      width: 9px;\n      height: 9px;\n      top: 2px;\n      left: 2px;\n    }\n  }\n\n  & input:checked + span {\n    & > span:nth-child(2) {\n      transform: translate3d(8px, 0, 0) !important;\n    }\n  }\n"]))),Ct={previewDrafts:"Drafts",published:"Published",raw:"Raw"},It="caution",zt="positive",Tt={previewDrafts:d.EditIcon,published:d.PublishIcon,raw:d.DatabaseIcon},Rt=r.forwardRef((function(t,o){const{dispatch:a,initialUrl:s,loadersConnection:l,navigatorEnabled:u,onPathChange:h,openPopup:m,overlayEnabled:v,overlaysConnection:g,params:x,perspective:y,previewKitConnection:b,targetOrigin:w,toggleNavigator:j,toggleOverlay:k,viewport:P}=t,{devMode:S}=B(),E=n.usePrefersReducedMotion(),C=r.useCallback((()=>a({type:ct,viewport:"desktop"})),[a]),I=r.useCallback((()=>a({type:ct,viewport:"mobile"})),[a]),[z,T]=r.useState(!0),[R,O]=r.useState(!1),[L,D]=r.useState(!1),[M,U]=r.useState(!1),A=z||L||"connecting"===g,W=r.useMemo((()=>w===location.origin?"":w),[w]),_=r.useCallback((()=>{"function"!=typeof o&&(null==o?void 0:o.current)&&(o.current.src="".concat(w).concat(x.preview||"/"),D(!0))}),[x.preview,w,o]),q=r.useCallback((()=>{"function"!=typeof o&&(null==o?void 0:o.current)&&(o.current.src=s.toString(),D(!0))}),[o,s]),N=r.useCallback((()=>{V(!0)}),[]),[$,V]=r.useState(!1),[K,G]=r.useState(!1);r.useEffect((()=>{if(!(z||L||"connecting"!==g&&"reconnecting"!==g)){const e=setTimeout((()=>{G(!0)}),1e3);return()=>clearTimeout(e)}}),[g,z,L]),r.useEffect((()=>{if(!z&&!L&&K){if("connected"===g&&(U(!1),G(!1),O(!1),V(!1)),"connecting"===g){const e=setTimeout((()=>{O(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")}),c.M);return()=>clearTimeout(e)}if("reconnecting"===g){const e=setTimeout((()=>{O(!0),U(!0)}),c.M);return()=>clearTimeout(e)}"disconnected"===g&&U(!0)}}),[z,g,L,K]);const J=r.useMemo((()=>{const e=new URL(x.preview||"/",w),{pathname:t,search:n}=p.withoutSecretSearchParams(e);return"".concat(t).concat(n)}),[x.preview,w]),H=r.useCallback((()=>{T(!1),D(!1)}),[]);return e.jsx(f.MotionConfig,{transition:E?{duration:0}:void 0,children:e.jsxs(n.TooltipDelayGroupProvider,{delay:1e3,children:[e.jsx(n.Card,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:e.jsxs(n.Flex,{align:"center",gap:2,style:{minHeight:0},children:[j&&e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Toggle navigator",fontSize:1,icon:d.PanelLeftIcon,mode:"bleed",onClick:j,padding:3,selected:u})}),e.jsx(n.Tooltip,{animate:!0,content:e.jsxs(n.Flex,{align:"center",style:{whiteSpace:"nowrap"},children:[e.jsx(n.Box,{padding:1,children:e.jsx(n.Text,{size:1,children:v?"Disable edit overlay":"Enable edit overlay"})}),e.jsx(n.Box,{paddingY:1,children:e.jsx(i.Hotkeys,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e.jsx(n.Card,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:v?"positive":void 0,children:e.jsxs(n.Flex,{align:"center",gap:2,children:[e.jsx("div",{style:{margin:-2},children:e.jsx(Et,{checked:v,onChange:k,disabled:A})}),e.jsx(n.Box,{children:e.jsx(n.Text,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),S&&e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:L?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Refresh preview",fontSize:1,icon:d.RefreshIcon,mode:"bleed",loading:L,onClick:_,padding:3})}),e.jsx(n.Box,{flex:1,children:e.jsx(wt,{onChange:h,origin:W,value:J})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:d.ShareIcon,mode:"bleed",padding:3,space:2}),id:"location-menu",menu:e.jsx(n.Menu,{children:e.jsx(Ut,{initialUrl:s,openPopup:m,previewLocationOrigin:W,previewLocationRoute:J})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsx(n.Flex,{align:"center",flex:"none",gap:1,children:e.jsx(n.MenuButton,{button:e.jsx(n.Button,{fontSize:1,iconRight:d.ChevronDownIcon,mode:"bleed",padding:3,space:2,text:Ct[y],loading:A||"connecting"===l&&"connected"!==b,disabled:"connected"!==l}),id:"perspective-menu",menu:e.jsxs(n.Menu,{style:{maxWidth:240},children:[e.jsx(n.MenuItem,{fontSize:1,onClick:()=>a({type:st,perspective:"previewDrafts"}),padding:3,pressed:"previewDrafts"===y,tone:It,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(Tt.previewDrafts)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:Ct.previewDrafts}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"previewDrafts"===y?1:0},children:e.jsx(d.CheckmarkIcon,{})})})]})}),e.jsx(n.MenuItem,{fontSize:1,onClick:()=>a({type:st,perspective:"published"}),padding:3,pressed:"published"===y,tone:zt,children:e.jsxs(n.Flex,{align:"flex-start",gap:3,children:[e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{size:1,children:r.createElement(Tt.published)})}),e.jsxs(n.Stack,{flex:1,space:2,children:[e.jsx(n.Text,{size:1,weight:"medium",children:Ct.published}),e.jsx(n.Text,{muted:!0,size:1,children:"View this page with published content"})]}),e.jsx(n.Box,{flex:"none",children:e.jsx(n.Text,{muted:!0,size:1,style:{opacity:"published"===y?1:0},children:e.jsx(d.CheckmarkIcon,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e.jsxs(n.Flex,{align:"center",flex:"none",gap:1,children:[e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Full viewport",fontSize:1,icon:d.DesktopIcon,mode:"bleed",onClick:C,padding:3,selected:"desktop"===P})}),e.jsx(n.Tooltip,{animate:!0,content:e.jsx(n.Text,{size:1,children:"Narrow viewport"}),padding:2,placement:"bottom",portal:!0,children:e.jsx(n.Button,{"aria-label":"Narrow viewport",fontSize:1,icon:d.MobileDeviceIcon,mode:"bleed",onClick:I,padding:3,selected:"mobile"===P})})]})]})}),e.jsx(n.Card,{flex:1,tone:"transparent",children:e.jsxs(n.Flex,{align:"center",height:"fill",justify:"center",padding:"desktop"===P?0:2,sizing:"border",style:{position:"relative",cursor:A?"wait":void 0},children:[e.jsx(f.AnimatePresence,{children:M||z||L||!K||$?!z&&!A||$?M&&!$?e.jsx(St,{initial:"initial",animate:"animate",exit:"exit",variants:Dt,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:e.jsx(F,{flex:1,message:"Could not connect to the preview",onRetry:q,onContinueAnyway:N,children:S&&e.jsxs(e.Fragment,{children:["connected"!==g&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Overlay connection status"}),e.jsx(n.Code,{size:1,children:g})]})}),"connected"!==l&&e.jsx(n.Card,{padding:3,radius:2,tone:"critical",children:e.jsxs(n.Stack,{space:3,children:[e.jsx(n.Label,{muted:!0,size:0,children:"Loader connection status"}),e.jsx(n.Code,{size:1,children:l})]})})]})})}):null:e.jsx(St,{initial:"initial",animate:"animate",exit:"exit",variants:Lt,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:e.jsxs(n.Flex,{style:{...Ot[P]},justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:"Loading…"})]})}):e.jsx(St,{initial:"initial",animate:"animate",exit:"exit",variants:Lt,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:R?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:R?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:e.jsxs(n.Flex,{style:{...Ot[P]},justify:"center",align:"center",direction:"column",gap:4,children:[R&&e.jsx(n.Button,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),e.jsx(n.Card,{radius:2,tone:R?"caution":"inherit",padding:4,shadow:1,children:e.jsxs(n.Flex,{justify:"center",align:"center",direction:"column",gap:4,children:[e.jsx(n.Spinner,{muted:!0}),e.jsx(n.Text,{muted:!0,size:1,children:R?e.jsx(e.Fragment,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),R&&e.jsx(n.Button,{fontSize:1,tone:"critical",onClick:N,text:"Continue anyway"})]})})}),e.jsx(bt,{ref:o,style:{pointerEvents:A&&!$?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:s.toString(),initial:["background"],variants:Mt,animate:[!z&&!A||$?"active":"background",L?"reloading":"idle",P,K&&!$?"timedOut":""],onLoad:H})]})})]})})})),Ot={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},Lt={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Dt={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Mt={desktop:{...Ot.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...Ot.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function Ut(t){const{initialUrl:i,openPopup:o,previewLocationOrigin:a,previewLocationRoute:s}=t,c=r.useCallback((e=>{e.preventDefault(),o(e.currentTarget.href)}),[o]);return e.jsxs(e.Fragment,{children:[e.jsx(At,{initialUrl:i,previewLocationOrigin:a,previewLocationRoute:s}),e.jsx(n.MenuItem,{icon:d.LaunchIcon,text:"Open preview",as:"a",href:"".concat(a).concat(s),onClick:c,rel:"opener",target:"_blank"})]})}function At(t){const{initialUrl:o,previewLocationOrigin:a,previewLocationRoute:s}=t,{push:l}=n.useToast(),f=i.useClient({apiVersion:c.A}),h=i.useCurrentUser(),[m,v]=r.useState(!1);return e.jsx(n.MenuItem,{disabled:m,onClick:()=>{if(!(null==navigator?void 0:navigator.clipboard))return l({closable:!0,status:"error",title:"Clipboard not supported"}),!1;let e;v(!0);let t="".concat(a).concat(s);const n=()=>{l({id:e,closable:!0,status:"success",title:"The URL is copied to the clipboard"}),v(!1)},r=e=>{l({closable:!0,status:"error",title:"Copy failed",description:e.message||e.toString()}),v(!1)};if(p.hasSecretSearchParams(o)&&"undefined"!=typeof ClipboardItem){const i="text/plain",a=new ClipboardItem({[i]:(async()=>{e=l({closable:!0,title:"Copying URL to clipboard…"});const n=await u.createPreviewSecret(f,"@sanity/presentation","undefined"==typeof window?"":location.href,null==h?void 0:h.id),r=p.setSecretSearchParams(o,n.secret,s);return t=r.toString(),new Blob([t],{type:i})})()});navigator.clipboard.write([a]).then(n).catch(r)}else navigator.clipboard.writeText(t).then(n).catch(r)},text:"Copy link",icon:d.CopyIcon})}let Ft=!1;function Bt(e){var t;if(void 0===e)return;const n=null==(t=decodeURIComponent(e))?void 0:t.split(".");return"drafts"===n[0]&&n.shift(),n.join(".")}function Wt(e){if(void 0!==e)return t.studioPath.toString(function(e){const t=[];for(const n of e.split(".")){const e=L.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=D.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=M.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function _t(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function qt({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:i,frameStateRef:o}){const a=r.useMemo((()=>{const{id:t,path:r,type:o}={id:Bt((a=n).id),path:Wt(a.path),type:a.type};var a;return{id:t,type:o,path:r,preview:i.preview||"".concat(e.pathname).concat(e.search),perspective:i.perspective,viewport:i.viewport,inspect:i.inspect,rev:i.rev,since:i.since,template:i.template,templateParams:i.templateParams,view:i.view,pathKey:i.pathKey,instruction:i.instruction,comment:i.comment}}),[n,i,e]),s=r.useMemo((()=>_t({inspect:a.inspect,path:a.path,rev:a.rev,since:a.since,template:a.template,templateParams:a.templateParams,view:a.view,pathKey:a.pathKey,instruction:a.instruction,comment:a.comment})),[a.comment,a.inspect,a.instruction,a.path,a.pathKey,a.rev,a.since,a.template,a.templateParams,a.view]),c=r.useRef(n);r.useEffect((()=>{c.current=n}),[n]);return{deskParams:s,navigate:r.useMemo((()=>ke(((e,n={},r)=>{const{_searchParams:i,...a}=c.current,s=(i||[]).reduce(((e,[t,n])=>(e[t]=n,e)),{}),l=_t({...a,...e}),d=_t({...s,...n});a.id!==l.id&&(delete d.template,delete d.templateParams),l._searchParams=Object.entries(d).reduce(((e,[t,n])=>[...e,[t,n]]),[]);const u=null!=r?r:d.preview===o.current.url;t(l,{replace:u})}),50)),[t,o]),params:a}}function Nt(e,t,n){var o,a;const s=i.useClient({apiVersion:c.A}),l=i.useActiveWorkspace(),d=(null==(o=null==l?void 0:l.activeWorkspace)?void 0:o.basePath)||"/",p=(null==(a=null==l?void 0:l.activeWorkspace)?void 0:a.name)||"default",f=function(e,t,n){const o=i.useCurrentUser();return r.useMemo((()=>["@sanity/presentation",t,n,e,null==o?void 0:o.id,$t]),[t,null==o?void 0:o.id,e,n])}(t,d,p),h=function(e,t){const n=i.useClient({apiVersion:c.A}),o=i.useCurrentUser(),[a,s]=r.useState(""),l=e?v.suspend((async()=>await u.createPreviewSecret(n,"@sanity/presentation","undefined"==typeof window?"":location.href,null==o?void 0:o.id)),[...t,a]):null;return r.useEffect((()=>{if(!l)return;const e=setTimeout((()=>{r.startTransition((()=>s(l.expiresAt.toString())))}),l.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[l]),(null==l?void 0:l.secret)||null}("object"==typeof e||"function"==typeof e,f);return v.suspend((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith("".concat(d,"/"))&&r.pathname!==d?r:t}const t="object"==typeof e?m.definePreviewUrl(e):e,r=await t({client:s,previewUrlSecret:h,previewSearchParam:n,referrer:"undefined"==typeof document?null:document.referrer,studioBasePath:d});return new URL(r,location.origin)}),[...f,h])}const $t=Symbol();var Vt,Kt=Object.freeze,Gt=Object.defineProperty;const Jt=r.lazy((()=>Promise.resolve().then((function(){return require("./LoaderQueries-wwMtTl5F.cjs")})))),Ht=r.lazy((()=>Promise.resolve().then((function(){return require("./RevalidateTags-DwL4JJVv.cjs")})))),Xt=x.default(n.Flex)(Vt||(Vt=((e,t)=>Kt(Gt(e,"raw",{value:Kt(t||e.slice())})))(["\n  overflow-x: auto;\n"])));exports.default=function(s){var d;const{previewUrl:u,components:p,unstable_emitExperimentalRevalidateTagsLoaderEvent:f}=null!=(d=s.tool.options)?d:{},h=s.tool.name||c.D,{unstable_navigator:m}=p||{},{navigate:v,state:g}=o.useRouter(),x=i.useUnique(Object.fromEntries(g._searchParams||[])),b=Nt(u||"/",h,x.preview||null),[w]=r.useState((()=>{var e;const t=null==(e=s.tool.options)?void 0:e.devMode;return"function"==typeof t?t():"boolean"==typeof t?t:"undefined"!=typeof window&&"localhost"===window.location.hostname})),j=r.useMemo((()=>b.origin),[b.origin]),k=r.useRef(null),[P,S]=r.useState(),[E,C]=r.useState({}),I=r.useRef({title:void 0,url:void 0}),{params:z,deskParams:T,navigate:R}=qt({initialPreviewUrl:b,routerNavigate:v,routerState:g,routerSearchParams:x,frameStateRef:I}),[L,D]=r.useReducer(dt,{perspective:z.perspective,viewport:z.viewport},vt),[M,F]=function(e){if("published"!==e&&"previewDrafts"!==e)throw new Error("Invalid perspective: ".concat(e));const[t,n]=r.useState({}),[i,o]=r.useState({}),a=r.useCallback(((e,t)=>{const r=t.filter((e=>"_projectId"in e&&e._projectId?(Ft||(console.warn("Cross dataset references are not supported yet, ignoring source document",e),Ft=!0),!1):e));("published"===e?n:o)((e=>{const t={};for(const e of r)t[e._id]=e;return y.default(e,t)?e:t}))}),[]);return[r.useMemo((()=>"published"===e?[...Object.values(t)]:[...Object.values(i)]),[e,i,t]),a]}(L.perspective),B=i.useProjectId(),W=i.useDataset();r.useEffect((()=>{L.perspective===z.perspective&&L.viewport===z.viewport||R({},{perspective:"previewDrafts"===L.perspective?void 0:L.perspective,viewport:"desktop"===L.viewport?void 0:L.viewport})}),[z.perspective,L.perspective,R,L.viewport,z.viewport]);const[_,q]=r.useState("connecting"),[N,$]=r.useState("connecting"),[V,K]=r.useState("connecting"),[G]=r.useState((()=>new Set)),J=r.useCallback((e=>{const t=window.open(e,"_blank");t&&G.add(t)}),[G]);r.useEffect((()=>{if(G.size&&P)for(const e of G)e&&"closed"in e&&!e.closed&&P.addSource(e)}),[P,G,G.size]),r.useEffect((()=>{var e;const t=null==(e=k.current)?void 0:e.contentWindow;if(!t)return;const n=function(e){const{destroy:t,send:n}=O(e),r=new Set,i=new WeakMap,o=new Set;return{destroy:()=>{t();for(const e of o)e()},send:(e,t,o)=>{n(e,t,o);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,t,o)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:a}=O({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(e,t)=>{if("preview-kit/documents"!==e&&"overlay/navigate"!==e&&"loader/documents"!==e)return n(e,t)}:void 0}}))});o.add(a),i.set(t,n),r.add(t)}}}({id:"presentation",target:t,targetOrigin:j,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:q,onEvent(e,t){if("overlay/focus"===e&&"id"in t)R({type:t.type,id:t.id,path:t.path});else if("overlay/navigate"===e){const{title:e,url:n}=t;I.current.url!==n&&R({},{preview:n}),I.current={title:e,url:n}}else"visual-editing/meta"===e?I.current.title=t.title:"overlay/toggle"===e&&D({type:lt,enabled:t.enabled})}},{id:"loaders",heartbeat:!0,onStatusUpdate:$,onEvent(e,t){if("loader/documents"===e&&t.projectId===B&&t.dataset===W)F(t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===B&&t.dataset===W){if("number"==typeof t.heartbeat&&t.heartbeat<c.c)throw new Error("Loader query listen heartbeat interval must be at least ".concat(c.c,"ms"));C((e=>{var n,r,i;return{...e,[(r=t.query,i=t.params,"".concat(r,"-").concat("string"==typeof i?i:JSON.stringify(i)))]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:null!=(n=t.heartbeat)&&n}}}))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:K,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===B&&t.dataset===W&&F(t.perspective,t.documents)}}]});return S(n),()=>{n.destroy(),S(void 0)}}),[W,B,F,R,j]),r.useEffect((()=>{const e=setInterval((()=>r.startTransition((()=>C((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))))),c.c);return()=>clearInterval(e)}),[]);const H=r.useCallback((e=>{R({path:t.studioPath.toString(e)},{},!0)}),[R]),X=r.useCallback((e=>{const t=new URL(e,b.origin),n=t.pathname+t.search;t.origin===b.origin&&n!==z.preview&&R({},{preview:n})}),[b,z,R]),Z=r.useCallback((e=>{R({},e)}),[R]);r.useEffect((()=>{z.id&&z.path?null==P||P.send("overlays","presentation/focus",{id:z.id,path:z.path}):null==P||P.send("overlays","presentation/blur",void 0)}),[P,z.id,z.path]),r.useEffect((()=>{I.current.url&&z.preview&&I.current.url!==z.preview&&(I.current.url=z.preview,"connected"!==_&&k.current?k.current.src="".concat(j).concat(z.preview):null==P||P.send("overlays","presentation/navigate",{url:z.preview,type:"replace"}))}),[P,_,j,z.preview]);const Q=r.useCallback((()=>null==P?void 0:P.send("overlays","presentation/toggleOverlay",void 0)),[P]),[Y,ee]=r.useState(null);r.useEffect((()=>{const e=e=>{A(e)&&Q()},t=e=>{var t;A(e)&&Q(),t=e,["mod","\\"].every((e=>U[e]?t[U[e]]:t.key===e.toUpperCase()))&&Q()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[Q]);const[te,ne]=r.useState(null),[{navigatorEnabled:re,toggleNavigator:ie},oe]=_e({unstable_navigator:m}),ae=r.useRef(z.id);r.useEffect((()=>{z.rev&&ae.current&&z.id!==ae.current&&R({},{rev:void 0}),ae.current=z.id}));const se=i.useWorkspace(),le=r.useCallback((({id:e,type:t,path:n})=>{if(I.current.url)return{title:I.current.title||I.current.url,name:"edit",params:{id:e,path:n,type:t,inspect:c.C,workspace:se.name,mode:c.E,preview:z.preview}}}),[z.preview,se.name]);return e.jsxs(e.Fragment,{children:[e.jsx($e,{deskParams:T,devMode:w,name:h,params:z,navigate:R,children:e.jsx(We,{navigate:R,children:e.jsx(Ne,{params:z,children:e.jsx(Xt,{height:"fill",children:e.jsxs(Be,{children:[e.jsx(oe,{}),e.jsx(he,{id:"preview",minWidth:325,defaultSize:re?50:75,order:3,children:e.jsx(n.Flex,{direction:"column",flex:1,height:"fill",ref:ne,children:e.jsx(n.BoundaryElementProvider,{element:te,children:e.jsx(Rt,{dispatch:D,initialUrl:b,loadersConnection:N,navigatorEnabled:re,onPathChange:X,openPopup:J,overlayEnabled:L.visualEditing.overlays.enabled,overlaysConnection:_,params:z,perspective:L.perspective,previewKitConnection:V,ref:k,targetOrigin:j,toggleNavigator:ie,toggleOverlay:Q,viewport:L.viewport})})})}),e.jsx(je,{order:4}),e.jsx(he,{id:"content",minWidth:325,order:5,children:e.jsx(l.D,{documentId:z.id,setDisplayedDocument:ee,children:e.jsx(a.CommentsIntentProvider,{getIntent:le,children:e.jsx(ce,{refs:M,deskParams:T,documentId:z.id,documentType:z.type,onDeskParams:Z,onFocusPath:H,previewUrl:z.preview})})})})]})})})})}),P&&e.jsx(r.Suspense,{children:e.jsx(Jt,{channel:P,liveQueries:E,perspective:L.perspective,liveDocument:Y,documentsOnPage:M})}),f&&P&&e.jsx(r.Suspense,{children:e.jsx(Ht,{channel:P})})]})};//# sourceMappingURL=PresentationTool-CunTHsNC.cjs.map
