import{jsx as e,jsxs as t,Fragment as n}from"react/jsx-runtime";import{studioPath as r}from"@sanity/client/csm";import{Card as i,Flex as o,Container as a,Stack as s,Text as c,Inline as l,Box as d,Button as p,Code as u,Label as h,ErrorBoundary as f,TextInput as m,Switch as v,usePrefersReducedMotion as g,TooltipDelayGroupProvider as y,Tooltip as w,MenuButton as b,Menu as x,MenuItem as k,Spinner as P,useToast as E,BoundaryElementProvider as S}from"@sanity/ui";import{useContext as z,forwardRef as C,useCallback as I,useMemo as O,useState as j,useEffect as D,createContext as R,useLayoutEffect as L,useRef as U,memo as T,createElement as A,startTransition as W,useReducer as _,Suspense as M,lazy as N}from"react";import{useUnique as $,getPublishedId as V,useActiveWorkspace as F,Hotkeys as K,useClient as B,useCurrentUser as q,useProjectId as G,useDataset as J,useWorkspace as X}from"sanity";import{StateLink as H,useRouter as Z,decodeJsonParams as Q}from"sanity/router";import{PaneRouterContext as Y,PaneLayout as ee,StructureToolProvider as te,DocumentListPane as ne,useStructureTool as re,DocumentPane as ie,CommentsIntentProvider as oe}from"sanity/structure";import ae from"styled-components";import{P as se,a as ce,b as le,M as de,A as pe,c as ue,C as he,E as fe,D as me}from"./index-UawcBtod.js";import{D as ve}from"./DisplayedDocumentBroadcaster-dBGbr7Ya.js";import{ResetIcon as ge,PanelLeftIcon as ye,RefreshIcon as we,ShareIcon as be,ChevronDownIcon as xe,CheckmarkIcon as ke,DesktopIcon as Pe,MobileDeviceIcon as Ee,LaunchIcon as Se,CopyIcon as ze,EditIcon as Ce,PublishIcon as Ie,DatabaseIcon as Oe}from"@sanity/icons";import{createPreviewSecret as je}from"@sanity/preview-url-secret/create-secret";import{withoutSecretSearchParams as De,hasSecretSearchParams as Re,setSecretSearchParams as Le}from"@sanity/preview-url-secret/without-secret-search-params";import{motion as Ue,MotionConfig as Te,AnimatePresence as Ae}from"framer-motion";import We from"fast-deep-equal";import{definePreviewUrl as _e}from"@sanity/preview-url-secret/define-preview-url";import{suspend as Me}from"suspend-react";let Ne;const $e=new Uint8Array(16);function Ve(){if(!Ne&&(Ne="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ne))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ne($e)}const Fe=[];for(let e=0;e<256;++e)Fe.push((e+256).toString(16).slice(1));var Ke={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Be(e,t,n){if(Ke.randomUUID&&!t&&!e)return Ke.randomUUID();const r=(e=e||{}).random||(e.rng||Ve)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return Fe[e[t+0]]+Fe[e[t+1]]+Fe[e[t+2]]+Fe[e[t+3]]+"-"+Fe[e[t+4]]+Fe[e[t+5]]+"-"+Fe[e[t+6]]+Fe[e[t+7]]+"-"+Fe[e[t+8]]+Fe[e[t+9]]+"-"+Fe[e[t+10]]+Fe[e[t+11]]+Fe[e[t+12]]+Fe[e[t+13]]+Fe[e[t+14]]+Fe[e[t+15]]}(r)}const qe=1e3,Ge=1e3,Je=500,Xe=["handshake/syn","handshake/syn-ack","handshake/ack"],He=e=>Xe.some((t=>t===e)),Ze=({data:e={}})=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&!("domain"in e)&&["id","type","from","to"].every((t=>t in e))&&e.type.startsWith("handshake/");function Qe(e){const t=e.target,n=e.connectTo.map((e=>({buffer:[],config:e,id:"",handler:i,status:"connecting",interval:void 0,heartbeat:void 0})));function r(e){window.clearInterval(e.interval)}function i(e){const{data:t}=e;if(He(t.type)){const e=n.find((e=>e.config.id===t.from));e&&"handshake/syn-ack"===t.type&&(c(e,"connected"),l(e,"handshake/ack",{id:e.id}))}}const o=t=>{var r,i,o;const{data:a}=t;if(!He(a.type)&&n.find((e=>e.id===a.connectionId))){const t=n.find((e=>e.config.id===a.from));if(t){const n=[a.type,a.data];null==(i=(r=t.config).onEvent)||i.call(r,...n),null==(o=e.onEvent)||o.call(e,...n),d(t,"channel/response",{responseTo:a.id},!1)}}};function a(t){var r;if(Ze(t))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(t){const{data:r,origin:i}=t;return"sanity/channels"===r.domain&&r.to==e.id&&n.map((e=>e.config.id)).includes(r.from)&&"channel/response"!==r.type&&i===e.targetOrigin}(t)){const{data:e}=t;null==(r=n.find((t=>t.config.id===e.from)))||r.handler(t)}}function s(e){e.heartbeat&&window.clearInterval(e.heartbeat)}function c(t,n){var a,c,p;t.status=n,null==(c=(a=t.config).onStatusUpdate)||c.call(a,n,t.config.id),null==(p=e.onStatusUpdate)||p.call(e,n,t.config.id),"connecting"===n||"reconnecting"===n?(t.handler=i,s(t),function(e){e.id=Be(),e.interval=window.setInterval((()=>{l(e,"handshake/syn",{id:e.id})}),Je)}(t)):"connected"===n?(t.handler=o,r(t),function(e){if(s(e),e.config.heartbeat){const t="number"==typeof e.config.heartbeat?e.config.heartbeat:Ge;e.heartbeat=window.setInterval((()=>{d(e,"channel/heartbeat")}),t)}}(t),function(e){const t=[...e.buffer];e.buffer.splice(0,e.buffer.length),t.forEach((({type:t,data:n})=>{d(e,t,n)}))}(t)):"disconnected"===n&&(t.id=null,t.handler=i,r(t),s(t))}function l(n,r,i){if(!n.id)throw new Error("No channel ID set");const o={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:Be(),to:n.config.id,type:r};try{null==t||t.postMessage(o,{targetOrigin:"*"})}catch(t){throw new Error("Failed to postMessage '".concat(o.id,"' on '").concat(e.id,"'"))}}function d(n,r,i,o=!0){const a=Be();if("connecting"===n.status||"reconnecting"===n.status||"disconnected"===n.status)return void n.buffer.push({type:r,data:i});if(!n.id)throw new Error("No channel ID set");const s={connectionId:n.id,data:i,domain:"sanity/channels",from:e.id,id:a,to:n.config.id,type:r};if(o){const t=setTimeout((()=>{s.connectionId===n.id&&(window.removeEventListener("message",o,!1),"channel/heartbeat"!==r&&n.buffer.push({type:r,data:i}),c(n,"reconnecting"),console.warn("Received no response to message '".concat(s.type,"' on client '").concat(e.id,"' (ID: '").concat(s.id,"').")))}),qe),o=e=>{var n;const{data:r}=e;"channel/response"===r.type&&(null==(n=r.data)?void 0:n.responseTo)&&r.data.responseTo===s.id&&(window.removeEventListener("message",o,!1),clearTimeout(t))};window.addEventListener("message",o,!1)}try{null==t||t.postMessage(s,{targetOrigin:e.targetOrigin})}catch(t){throw new Error("Failed to postMessage '".concat(s.id,"' on client '").concat(e.id,"'"))}}return window.addEventListener("message",a,!1),n.forEach((e=>{c(e,"connecting")})),{destroy:function(){n.forEach((e=>{["disconnected"].includes(e.status)||(d(e,"channel/disconnect",{id:e.id},!1),c(e,"disconnected"))})),window.removeEventListener("message",a,!1),n.forEach((e=>{s(e),r(e)}))},send:function(e,t,r){(e?Array.isArray(e)?[...e]:[e]:n).forEach((e=>{const i=n.find((t=>t.config.id===e));if(!i)throw new Error("Invalid channel ID");d(i,t,r)}))}}}const Ye=/^([A-Za-z]+):([0-9]+)$/,et=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,tt=/^([A-Za-z]+):([a-z0-9]+)$/;const nt={alt:"altKey",ctrl:"ctrlKey",mod:"undefined"!=typeof window&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function rt(e){return"Alt"===e.key}function it(n){const{children:r,message:u,onRetry:h,onContinueAnyway:f,...m}=n,v=e(p,{fontSize:1,mode:"ghost",onClick:h,text:"Retry"}),g=e(p,{fontSize:1,mode:"ghost",tone:"critical",onClick:f,text:"Continue anyway"});return e(i,{height:"fill",...m,children:e(o,{align:"center",height:"fill",justify:"center",children:e(a,{padding:4,sizing:"border",width:0,children:t(s,{space:4,children:[t(s,{space:3,children:[e(c,{size:1,weight:"semibold",children:"An error occured"}),e(c,{muted:!0,size:1,children:u})]}),r,h&&f?t(l,{space:2,children:[v,g]}):h?e(d,{children:v}):f?e(d,{children:g}):null]})})})})}function ot(){const e=z(se);if(!e)throw new Error("Presentation context is missing");return e}function at(e){const t=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(e={}){const t=Object.entries(e).map((([e,t])=>"".concat(e,"=").concat(t))).join("&");return t.length?"?".concat(t):""}(Object.entries(e).filter((([e])=>t.includes(e))).reduce(((e,[t,n])=>null==n?e:{...e,[t]:n}),{}))}const st=C((function(t,n){const{deskParams:r,params:i}=ot();return e(H,{...t,ref:n,state:{type:void 0,_searchParams:Object.entries({...r,preview:i.preview})},title:void 0})})),ct=C((function(t,n){const{documentId:r,documentType:i,parentRefPath:o,template:a,...s}=t;return e(H,{...s,ref:n,state:{id:r,type:i},title:void 0})}));function lt(t){const{children:r,params:i,onDeskParams:o,previewUrl:a,refs:s}=t,{state:c,resolvePathFromState:l}=Z(),d=$(Object.fromEntries(c._searchParams||[])),p=I((e=>{const t=l(c),n=at({...d,...e});return"".concat(t).concat(n)}),[l,d,c]),u=O((()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:i,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:t=>{const{childId:n,...r}=t,i=null==s?void 0:s.find((e=>e._id===n||V(e._id)===n));return i?e(H,{...r,state:{id:n,type:i._type,_searchParams:Object.entries({preview:a})}}):e("div",{...r})},BackLink:st,ReferenceChildLink:ct,ParameterizedLink:()=>e(n,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:e=>{console.warn("handleEditReference",e)},replaceCurrent:e=>{console.warn("replaceCurrent",e)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:e=>{console.warn("duplicateCurrent",e)},setView:e=>{console.warn("setView",e)},setParams:e=>{var t;o({...e,inspect:null!=(t=e.inspect)?t:void 0})},setPayload:e=>{console.warn("setPayload",e)},navigateIntent:(e,t,n)=>{console.warn("navigateIntent",e,t,n)},createPathWithParams:p})),[p,o,i,a,s]);return e(Y.Provider,{value:u,children:r})}var dt,pt,ut,ht=Object.freeze,ft=Object.defineProperty,mt=(e,t)=>ht(ft(e,"raw",{value:ht(t||e.slice())}));const vt=ae(ee)(dt||(dt=mt(["\n  height: 100%;\n"]))),gt=ae(o)(pt||(pt=mt(["\n  & > div {\n    min-width: none !important;\n    max-width: none !important;\n  }\n"]))),yt=ae(u)(ut||(ut=mt(["\n  white-space: pre-wrap;\n"])));function wt(n){const{onDeskParams:r,previewUrl:o,refs:a}=n,{devMode:c}=ot(),l=O((()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:a.map((e=>e._id))}},schemaTypeName:"",title:"Documents on this page",type:"documentList"})),[a]),[d,p]=j(null),u=I((()=>p(null)),[]),[m]=j((()=>({})));return D((()=>p(null)),[a]),d?e(it,{flex:1,message:"Could not render the document list",onRetry:u,children:c&&e(i,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(s,{space:3,children:[e(h,{muted:!0,size:0,children:"Error message"}),e(yt,{size:1,children:d.error.message})]})})}):e(f,{onCatch:p,children:e(vt,{children:e(te,{children:e(lt,{params:m,onDeskParams:r,previewUrl:o,refs:a,children:e(gt,{direction:"column",flex:1,children:e(ne,{index:0,itemId:"$root",pane:l,paneKey:"$root"})})})})})})}var bt,xt=Object.freeze,kt=Object.defineProperty;const Pt=ae(u)(bt||(bt=xt(kt(Et=["\n  white-space: pre-wrap;\n"],"raw",{value:xt(St||Et.slice())}))));var Et,St;function zt(n){const{documentId:r,documentType:o,params:a,onDeskParams:c,onFocusPath:l}=n,{template:d,templateParams:p}=a,{devMode:u}=ot(),m=O((()=>({id:r,options:{id:r,type:o,template:d,templateParameters:Q(p)},title:"",type:"document"})),[r,o,d,p]),[v,g]=j(null),y=I((()=>g(null)),[]);D((()=>{g(null)}),[r,o,a]);const{setLayoutCollapsed:w}=re(),b=I((()=>w(!0)),[w]),x=I((()=>w(!1)),[w]);return v?e(it,{flex:1,message:"Could not render the document editor",onRetry:y,children:u&&e(i,{overflow:"auto",padding:3,radius:2,tone:"critical",children:t(s,{space:3,children:[e(h,{muted:!0,size:0,children:"Error message"}),e(Pt,{size:1,children:v.error.message})]})})}):e(f,{onCatch:g,children:e(ee,{style:{height:"100%"},onExpand:x,onCollapse:b,children:e(lt,{onDeskParams:c,params:a,children:e(ie,{paneKey:"document",index:1,itemId:"document",pane:m,onFocusPath:l})})})})}function Ct(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a}=t;return e(te,{children:e(zt,{documentId:r,documentType:i,params:n,onDeskParams:o,onFocusPath:a})})}function It(t){const{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a,previewUrl:s,refs:c}=t;return r&&i?e(Ct,{deskParams:n,documentId:r,documentType:i,onDeskParams:o,onFocusPath:a}):e(wt,{onDeskParams:o,previewUrl:s,refs:c})}const Ot=R(null);Ot.displayName="PanelsContext";var jt,Dt=Object.freeze,Rt=Object.defineProperty;const Lt=ae.div(jt||(jt=((e,t)=>Dt(Rt(e,"raw",{value:Dt(t||e.slice())})))(["\n  overflow: hidden;\n  flex-basis: 0;\n  flex-shrink: 1;\n"]))),Ut=function({children:t,defaultSize:n=null,id:r,minWidth:i,maxWidth:o,order:a=0}){const s=z(Ot);if(null===s)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:c,registerElement:l,unregisterElement:d}=s,p=c(r);return L((()=>(l(r,{id:r,type:"panel",defaultSize:n,maxWidth:null!=o?o:null,minWidth:null!=i?i:0,order:a}),()=>{d(r)})),[r,n,a,o,i,l,d]),e(Lt,{style:p,children:t})};var Tt,At,Wt=Object.freeze,_t=Object.defineProperty,Mt=(e,t)=>Wt(_t(e,"raw",{value:Wt(t||e.slice())}));const Nt=ae.div(Tt||(Tt=Mt(["\n  position: relative;\n"]))),$t=ae.div(At||(At=Mt(["\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: -5px;\n  width: 9px;\n  z-index: 10;\n  cursor: ",";\n\n  /* Border */\n  & > span:nth-child(1) {\n    display: block;\n    border-left: 1px solid var(--card-border-color);\n    position: absolute;\n    top: 0;\n    left: 4px;\n    bottom: 0;\n    transition: opacity 200ms;\n  }\n\n  ","\n"])),(({$disabled:e})=>e?"auto":"ew-resize"),(({$disabled:e})=>!e&&"\n    /* Hover effect */\n    & > span:nth-child(2) {\n      display: block;\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 9px;\n      bottom: 0;\n      background-color: var(--card-border-color);\n      opacity: 0;\n      transition: opacity 150ms;\n    }\n\n    @media (hover: hover) {\n      &:hover > span:nth-child(2) {\n        opacity: 0.2;\n      }\n    }\n  ")),Vt=function({id:n,order:r,disabled:i=!1}){const o=U(null),a=z(Ot);if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const s=function(e){return U(e||Be()).current}(n),{activeResizer:c,drag:l,startDragging:d,stopDragging:p,registerElement:u,unregisterElement:h}=a,f=c===s;if(null===a)throw Error("Panel components must be rendered within a PanelGroup container");const m=I((e=>{d(s,e.nativeEvent)}),[s,d]),v=I((e=>{l(s,e)}),[s,l]),g=I((()=>{o.current.blur(),p()}),[p]);return D((()=>{if(f&&!i)return window.addEventListener("mousemove",v),window.addEventListener("mouseup",g),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",g)}}),[i,f,v,g]),L((()=>(u(s,{id:s,order:r,type:"resizer",el:o}),()=>{h(s)})),[s,r,u,h]),e(Nt,{onMouseDown:m,ref:o,children:t($t,{$disabled:i,children:[e("span",{}),e("span",{})]})})};function Ft(e,t){let n;return(...r)=>{clearTimeout(n),n=setTimeout((()=>{e.apply(e,r)}),t)}}const Kt="presentation/panels",Bt=()=>JSON.parse(localStorage.getItem(Kt)||"{}"),qt=e=>e.map((e=>[e.id,e.order].join(":"))).join(",");function Gt(){return O((()=>{const e=(e,t)=>{(e=>{localStorage.setItem(Kt,JSON.stringify(e))})({...Bt(),[qt(e)]:t})};return{get:e=>Bt()[qt(e)],set:e,setDebounced:Ft(e,100)}}),[])}function Jt(e,t,n){const{maxWidth:r,minWidth:i}=e,o=null==r?100:r/n*100,a=i/n*100;return Math.min(o,Math.max(a,t))}function Xt(e,t,n){if(1===e.length)return"100";const r=n[e.findIndex((e=>e.id===t))];return null==r?"0":r.toPrecision(10)}function Ht(e,t,n=0,r=null){return e.clientX-(r||t.getBoundingClientRect()).left-n}function Zt(e){return"panel"===e.type}function Qt(e){return"resizer"===e.type}function Yt(e){return Array.from(e.values()).sort((({order:e},{order:t})=>null==e&&null==t?0:null==e?-1:null==t?1:e-t))}function en(e,t,n){const r=t.reduce(((e,t)=>e+t),0),i=[...t].map((e=>e/r*100));let o=0;for(let t=0;t<e.length;t++){const r=e[t],a=i[t],s=Jt(r,a,n);a!=s&&(o+=a-s,i[t]=s)}if("0.000"!==o.toFixed(3))for(let t=0;t<e.length;t++){const r=e[t];let{maxWidth:a,minWidth:s}=r;s=s/n*100,null!=a&&(a=a/n*100);const c=Math.min(null!=a?a:100,Math.max(s,i[t]+o));if(c!==i[t]&&(o-=c-i[t],i[t]=c,"0.000"===Math.abs(o).toFixed(3)))break}return i}var tn,nn=Object.freeze,rn=Object.defineProperty;const on=ae.div(tn||(tn=((e,t)=>nn(rn(e,"raw",{value:nn(t||e.slice())})))(["\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  overflow: hidden;\n  width: 100%;\n"]))),an=function({children:t}){const n=U(null),[r,i]=j(new Map),o=O((()=>Yt(r).filter(Zt)),[r]),[a,s]=j([]),[c,l]=j(null),d=U({elements:r,panels:o,widths:a}),p=I((e=>({flexGrow:Xt(o,e,a),pointerEvents:null===c?void 0:"none"})),[c,o,a]),u=I(((e,t)=>{i((n=>{if(n.has(e))return n;const r=new Map(n);return r.set(e,t),r}))}),[]),h=I((e=>{i((t=>{if(!t.has(e))return t;const n=new Map(t);return n.delete(e),n}))}),[]),f=U({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),m=I(((e,t)=>{const n=Yt(r),i=n.findIndex((t=>t.id===e)),o=r.get(e);if(!o||!Qt(o))return;const a=o.el.current;a&&(f.current={resizerIndex:i,panelBefore:n.reduce(((e,t,n)=>Zt(t)&&n<i?t:e),null),panelAfter:n.reduce(((e,t,n)=>null===e&&Zt(t)&&n>i?t:e),null),containerWidth:window.innerWidth,startX:t.pageX,dragOffset:Ht(t,a),resizerRect:a.getBoundingClientRect(),widths:d.current.widths},l(e))}),[r]),v=I((()=>{l(null)}),[]),g=I(((e,t)=>{t.preventDefault(),t.stopPropagation();const{containerWidth:i,dragOffset:o,panelBefore:a,panelAfter:c,resizerRect:l}=f.current;if(null==a||null==c)return;const p=r.get(e);if(!p||!Qt(p))return;const u=p.el.current;if(!u)return;const h=Ht(t,u,o,l);if(0===h)return;const{widths:m}=d.current,v=function(e,t,n,r,i,o){const{panels:a,widths:s}=i,{widths:c}=o,l=c||s,d=[...l];{const i=e<0?r:n,o=l[a.findIndex((e=>e.id===i.id))],s=Jt(i,o+Math.abs(e),t);if(o===s)return l;e=e<0?o-s:s-o}let p=0,u=e<0?n:r,h=a.findIndex((e=>e.id===u.id));for(;;){const n=a[h],r=l[h],i=Jt(n,r-(Math.abs(e)-Math.abs(p)),t);if(r!==i&&(p+=r-i,d[h]=i,p.toPrecision(10).localeCompare(Math.abs(e).toPrecision(10),void 0,{numeric:!0})>=0))break;if(e<0){if(--h<0)break}else if(++h>=a.length)break}return 0===p?l:(u=e<0?r:n,h=a.findIndex((e=>e.id===u.id)),d[h]=l[h]+p,d)}(h/n.current.getBoundingClientRect().width*100,i,a,c,d.current,f.current),g=m.some(((e,t)=>e!==v[t]));g&&s(v)}),[r]);L((()=>{d.current.elements=r,d.current.panels=o,d.current.widths=a}),[r,o,a]);const y=Gt();L((()=>{const{widths:e}=d.current;if(e.length===o.length)return;const t=y.get(o);if(t){const e=en(o,t,window.innerWidth);return void s(e)}const n=function(e){let t=e.length,n=100;const r=e.map((e=>e.defaultSize?(n-=e.defaultSize,t-=1,e.defaultSize):null)),i=n/t;return r.map((e=>null===e?i:e))}(o);s(n)}),[y,o]),D((()=>{a.length&&y.setDebounced(o,a)}),[y,o,a]),L((()=>{const e=new ResizeObserver((()=>{const{panels:e,widths:t}=d.current,n=en(e,t,window.innerWidth),r=t.some(((e,t)=>e!==n[t]));r&&s(n)}));return e.observe(n.current),()=>{e.disconnect()}}),[]);const w=O((()=>({activeResizer:c,drag:g,getPanelStyle:p,registerElement:u,startDragging:m,stopDragging:v,unregisterElement:h})),[c,g,p,u,m,v,h]);return e(Ot.Provider,{value:w,children:e(on,{ref:n,children:t})})},sn=function(t){const{children:n,navigate:r}=t,i=I(((e,t=void 0)=>{r(t||{},e?{preview:e}:{})}),[r]);return e(ce.Provider,{value:i,children:n})};function cn(t){const{unstable_navigator:r}=t,i=!!(null==r?void 0:r.component),[o,a]=function(e,t){const[n,r]=j((()=>{var n;return JSON.parse(null!=(n=localStorage.getItem(e))?n:JSON.stringify(t))}));return D((()=>{localStorage.setItem(e,JSON.stringify(n))}),[e,n]),[n,r]}("presentation/navigator",i),s=!!i&&o,c=O((()=>{if(i)return()=>a((e=>!e))}),[i,a]),l=I((function(){return e(n,{children:s&&e(ln,{...r})})}),[s,r]);return[{navigatorEnabled:s,toggleNavigator:c},l]}const ln=T((function(r){const{minWidth:i,maxWidth:o,component:a}=r,s=null!=i&&null!=o&&i===o;return t(n,{children:[e(Ut,{id:"navigator",minWidth:i,maxWidth:o,order:1,children:e(a,{})}),e(Vt,{order:2,disabled:s})]})})),dn=function(t){const{children:n,params:r}=t,i=O((()=>r),[r]);return e(le.Provider,{value:i,children:n})},pn=function(t){const{children:n,deskParams:r,devMode:i,name:o,navigate:a,params:s}=t,c=O((()=>({deskParams:r,devMode:i,name:o,navigate:a,params:s})),[r,i,o,a,s]);return e(se.Provider,{value:c,children:n})};var un,hn,fn,mn,vn=class extends Error{issues;constructor(e){super(e[0].message),this.name="ValiError",this.issues=e}};function gn(e,t){return Array.isArray(e)?[void 0,e]:[e,t]}function yn(e,t,n,r){const i=e.message??function(e,t){return mn?.get(e)?.get(t)}(t,r.lang)??("type"===e.type?(o=r.lang,fn?.get(o)):null)??n?.message??function(e){return hn?.get(e)}(r.lang)??r.message;var o;return"function"==typeof i?i(r):i}function wn(e,t,n){return{typed:e,output:t,issues:n}}function bn(e){let t=typeof e;return"object"===t&&(t=e?Object.getPrototypeOf(e).constructor.name:"null"),"string"===t?`"${e}"`:"number"===t||"bigint"===t||"boolean"===t?`${e}`:t}function xn(e,t,n){const r=n.received??bn(n.input),i={reason:e.type,context:n.context.type,expected:n.context.expects,received:r,message:`Invalid ${n.label}: ${n.context.expects?`Expected ${n.context.expects} but r`:"R"}eceived ${r}`,input:n.input,requirement:n.context.requirement,path:n.path,lang:t?.lang,abortEarly:t?.abortEarly,abortPipeEarly:t?.abortPipeEarly,skipPipe:t?.skipPipe};return i.message=yn(n.context,n.reference,t,i),i}function kn(e,t,n,r){if(e.pipe&&!n?.skipPipe)for(const i of e.pipe){const o=i._parse(t);if(o.issues){for(const t of o.issues){const i=xn(e,n,t);r?r.push(i):r=[i]}if(n?.abortEarly||n?.abortPipeEarly)break}else t=o.output}return wn(!0,t,r)}function Pn(e,t,n,r,i){const o=bn(n),a=i?.expected??e.expects,s={reason:i?.reason??"type",context:e.type,expected:a,received:o,message:`Invalid type: Expected ${a} but received ${o}`,input:n,path:i?.path,issues:i?.issues,lang:r?.lang,abortEarly:r?.abortEarly,abortPipeEarly:r?.abortPipeEarly,skipPipe:r?.skipPipe};return s.message=yn(e,t,r,s),{typed:!1,output:n,issues:[s]}}function En(e,t){return{...e,fallback:t,_parse(t,n){const r=e._parse(t,n);return r.issues?wn(!0,function(e,t){return"function"==typeof e.fallback?e.fallback(t):e.fallback}(this,{input:t,issues:r.issues})):r}}}function Sn(e,t,n,r){const[i,o,a]=function(e,t,n){if(!e||"object"==typeof e&&!Array.isArray(e)){const[r,i]=gn(t,n);return[e,r,i]}const[r,i]=gn(e,t);return[void 0,r,i]}(t,n,r);let s;return{type:"object",expects:"Object",async:!1,entries:e,rest:i,message:o,pipe:a,_parse(e,t){if(e&&"object"==typeof e){s=s??Object.entries(this.entries);let n,r=!0;const i={};for(const[o,a]of s){const s=e[o],c=a._parse(s,t);if(c.issues){const i={type:"object",origin:"value",input:e,key:o,value:s};for(const e of c.issues)e.path?e.path.unshift(i):e.path=[i],n?.push(e);if(n||(n=c.issues),t?.abortEarly){r=!1;break}}c.typed||(r=!1),(void 0!==c.output||o in e)&&(i[o]=c.output)}if(this.rest&&(!t?.abortEarly||!n))for(const o in e)if(!(o in this.entries)){const a=e[o],s=this.rest._parse(a,t);if(s.issues){const i={type:"object",origin:"value",input:e,key:o,value:a};for(const e of s.issues)e.path?e.path.unshift(i):e.path=[i],n?.push(e);if(n||(n=s.issues),t?.abortEarly){r=!1;break}}s.typed||(r=!1),i[o]=s.output}return r?kn(this,i,t,n):wn(!1,i,n)}return Pn(this,Sn,e,t)}}}function zn(e,t){return{type:"picklist",expects:e.map(bn).join(" | "),async:!1,options:e,message:t,_parse(e,t){return this.options.includes(e)?wn(!0,e):Pn(this,zn,e,t)}}}function Cn(e,t,n){const r=e._parse(t,function(e){return{lang:e?.lang??un?.lang,message:e?.message,abortEarly:e?.abortEarly??un?.abortEarly,abortPipeEarly:e?.abortPipeEarly??un?.abortPipeEarly,skipPipe:e?.skipPipe??un?.skipPipe}}(n));if(r.issues)throw new vn(r.issues);return r.output}const In="ACTION_PERSPECTIVE",On="ACTION_VIEWPORT",jn="ACTION_VISUAL_EDITING_OVERLAYS_TOGGLE",Dn=(e,t)=>{switch(t.type){case In:return{...e,perspective:Cn(Ln,t.perspective)};case On:return{...e,viewport:Cn(Un,t.viewport)};case jn:return Rn(e,t);default:return e}},Rn=(e,t)=>e.visualEditing.overlays.enabled===t.enabled?e:{...e,visualEditing:{...e.visualEditing,overlays:{...e.visualEditing.overlays,enabled:t.enabled}}},Ln=En(zn(["published","previewDrafts"]),"previewDrafts"),Un=En(zn(["desktop","mobile"]),"desktop"),Tn=Sn({perspective:Ln,viewport:Un,visualEditing:Sn({overlays:Sn({enabled:function e(t,n){const[r,i]=gn(t,n);return{type:"boolean",expects:"boolean",async:!1,message:r,pipe:i,_parse(t,n){return"boolean"==typeof t?kn(this,t,n):Pn(this,e,t,n)}}}()})})}),An={perspective:"previewDrafts",viewport:"desktop",visualEditing:{overlays:{enabled:!1}}};function Wn(e){return Cn(Tn,{...An,...e})}var _n,Mn=Object.freeze,Nn=Object.defineProperty;const $n=Ue(ae.iframe(_n||(_n=((e,t)=>Mn(Nn(e,"raw",{value:Mn(t||e.slice())})))(["\n  border: 0;\n  max-height: 100%;\n  width: 100%;\n  display: block;\n"])))),Vn=function(t){var r;const{basePath:i="/"}=(null==(r=F())?void 0:r.activeWorkspace)||{},{fontSize:o=1,onChange:a,origin:s,padding:c=3,value:l}=t,d=U(null),[p,u]=j(void 0),[h,f]=j(void 0),v=I((e=>{u(e.currentTarget.value)}),[]),g=I((e=>{var t;if("Enter"===e.key){if(void 0===p)return;const e=p.startsWith("/")||""===p?"".concat(s).concat(p):p;if(!e.startsWith(s+"/")&&e!==s)return void f("URL must start with ".concat(s));if(!s&&(e.startsWith("".concat(i,"/"))||e===i))return void f("URL can't have the same base path as the Studio ".concat(i));const n=e===s?s+"/":e;f(void 0),u(void 0),a(n.slice(s.length)),null==(t=d.current)||t.blur()}"Escape"===e.key&&(f(void 0),u(void 0))}),[i,a,s,p]),y=I((()=>{f(void 0),u(void 0)}),[]);D((()=>{f(void 0),u(void 0)}),[s,l]);const w=O((()=>({icon:ge})),[]);return e(n,{children:e(m,{clearButton:h?w:void 0,customValidity:h,fontSize:o,onBlur:y,onClear:()=>{f(void 0),u(s+l)},onChange:v,onKeyDownCapture:g,padding:c,style:{zIndex:1},radius:2,ref:d,space:c,value:void 0===p?"".concat(s).concat(l):p})})};var Fn,Kn=Object.freeze,Bn=Object.defineProperty;const qn=Ue(o),Gn=ae(v)(Fn||(Fn=((e,t)=>Kn(Bn(e,"raw",{value:Kn(t||e.slice())})))(["\n  & > span {\n    width: 21px;\n    height: 13px;\n    overflow: hidden;\n\n    & > span:nth-child(1) {\n      width: 21px;\n      height: 13px;\n    }\n\n    & > span:nth-child(2) {\n      width: 9px;\n      height: 9px;\n      top: 2px;\n      left: 2px;\n    }\n  }\n\n  & input:checked + span {\n    & > span:nth-child(2) {\n      transform: translate3d(8px, 0, 0) !important;\n    }\n  }\n"]))),Jn={previewDrafts:"Drafts",published:"Published",raw:"Raw"},Xn="caution",Hn="positive",Zn={previewDrafts:Ce,published:Ie,raw:Oe},Qn=C((function(r,a){const{dispatch:l,initialUrl:f,loadersConnection:m,navigatorEnabled:v,onPathChange:E,openPopup:S,overlayEnabled:z,overlaysConnection:C,params:R,perspective:L,previewKitConnection:U,targetOrigin:T,toggleNavigator:W,toggleOverlay:_,viewport:M}=r,{devMode:N}=ot(),$=g(),V=I((()=>l({type:On,viewport:"desktop"})),[l]),F=I((()=>l({type:On,viewport:"mobile"})),[l]),[B,q]=j(!0),[G,J]=j(!1),[X,H]=j(!1),[Z,Q]=j(!1),Y=B||X||"connecting"===C,ee=O((()=>T===location.origin?"":T),[T]),te=I((()=>{"function"!=typeof a&&(null==a?void 0:a.current)&&(a.current.src="".concat(T).concat(R.preview||"/"),H(!0))}),[R.preview,T,a]),ne=I((()=>{"function"!=typeof a&&(null==a?void 0:a.current)&&(a.current.src=f.toString(),H(!0))}),[a,f]),re=I((()=>{oe(!0)}),[]),[ie,oe]=j(!1),[ae,se]=j(!1);D((()=>{if(!(B||X||"connecting"!==C&&"reconnecting"!==C)){const e=setTimeout((()=>{se(!0)}),1e3);return()=>clearTimeout(e)}}),[C,B,X]),D((()=>{if(!B&&!X&&ae){if("connected"===C&&(Q(!1),se(!1),J(!1),oe(!1)),"connecting"===C){const e=setTimeout((()=>{J(!0),console.error("Unable to connect to visual editing. Make sure you've setup '@sanity/visual-editing' correctly")}),de);return()=>clearTimeout(e)}if("reconnecting"===C){const e=setTimeout((()=>{J(!0),Q(!0)}),de);return()=>clearTimeout(e)}"disconnected"===C&&Q(!0)}}),[B,C,X,ae]);const ce=O((()=>{const e=new URL(R.preview||"/",T),{pathname:t,search:n}=De(e);return"".concat(t).concat(n)}),[R.preview,T]),le=I((()=>{q(!1),H(!1)}),[]);return e(Te,{transition:$?{duration:0}:void 0,children:t(y,{delay:1e3,children:[e(i,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:t(o,{align:"center",gap:2,style:{minHeight:0},children:[W&&e(w,{animate:!0,content:e(c,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Toggle navigator",fontSize:1,icon:ye,mode:"bleed",onClick:W,padding:3,selected:v})}),e(w,{animate:!0,content:t(o,{align:"center",style:{whiteSpace:"nowrap"},children:[e(d,{padding:1,children:e(c,{size:1,children:z?"Disable edit overlay":"Enable edit overlay"})}),e(d,{paddingY:1,children:e(K,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:e(i,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:z?"positive":void 0,children:t(o,{align:"center",gap:2,children:[e("div",{style:{margin:-2},children:e(Gn,{checked:z,onChange:_,disabled:Y})}),e(d,{children:e(c,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),N&&e(w,{animate:!0,content:e(c,{size:1,children:X?"Refreshing…":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Refresh preview",fontSize:1,icon:we,mode:"bleed",loading:X,onClick:te,padding:3})}),e(d,{flex:1,children:e(Vn,{onChange:E,origin:ee,value:ce})}),e(o,{align:"center",flex:"none",gap:1,children:e(b,{button:e(p,{fontSize:1,iconRight:be,mode:"bleed",padding:3,space:2}),id:"location-menu",menu:e(x,{children:e(rr,{initialUrl:f,openPopup:S,previewLocationOrigin:ee,previewLocationRoute:ce})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),e(o,{align:"center",flex:"none",gap:1,children:e(b,{button:e(p,{fontSize:1,iconRight:xe,mode:"bleed",padding:3,space:2,text:Jn[L],loading:Y||"connecting"===m&&"connected"!==U,disabled:"connected"!==m}),id:"perspective-menu",menu:t(x,{style:{maxWidth:240},children:[e(k,{fontSize:1,onClick:()=>l({type:In,perspective:"previewDrafts"}),padding:3,pressed:"previewDrafts"===L,tone:Xn,children:t(o,{align:"flex-start",gap:3,children:[e(d,{flex:"none",children:e(c,{size:1,children:A(Zn.previewDrafts)})}),t(s,{flex:1,space:2,children:[e(c,{size:1,weight:"medium",children:Jn.previewDrafts}),e(c,{muted:!0,size:1,children:"View this page with latest draft content"})]}),e(d,{flex:"none",children:e(c,{muted:!0,size:1,style:{opacity:"previewDrafts"===L?1:0},children:e(ke,{})})})]})}),e(k,{fontSize:1,onClick:()=>l({type:In,perspective:"published"}),padding:3,pressed:"published"===L,tone:Hn,children:t(o,{align:"flex-start",gap:3,children:[e(d,{flex:"none",children:e(c,{size:1,children:A(Zn.published)})}),t(s,{flex:1,space:2,children:[e(c,{size:1,weight:"medium",children:Jn.published}),e(c,{muted:!0,size:1,children:"View this page with published content"})]}),e(d,{flex:"none",children:e(c,{muted:!0,size:1,style:{opacity:"published"===L?1:0},children:e(ke,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),t(o,{align:"center",flex:"none",gap:1,children:[e(w,{animate:!0,content:e(c,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Full viewport",fontSize:1,icon:Pe,mode:"bleed",onClick:V,padding:3,selected:"desktop"===M})}),e(w,{animate:!0,content:e(c,{size:1,children:"Narrow viewport"}),padding:2,placement:"bottom",portal:!0,children:e(p,{"aria-label":"Narrow viewport",fontSize:1,icon:Ee,mode:"bleed",onClick:F,padding:3,selected:"mobile"===M})})]})]})}),e(i,{flex:1,tone:"transparent",children:t(o,{align:"center",height:"fill",justify:"center",padding:"desktop"===M?0:2,sizing:"border",style:{position:"relative",cursor:Y?"wait":void 0},children:[e(Ae,{children:Z||B||X||!ae||ie?!B&&!Y||ie?Z&&!ie?e(qn,{initial:"initial",animate:"animate",exit:"exit",variants:tr,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:e(it,{flex:1,message:"Could not connect to the preview",onRetry:ne,onContinueAnyway:re,children:N&&t(n,{children:["connected"!==C&&e(i,{padding:3,radius:2,tone:"critical",children:t(s,{space:3,children:[e(h,{muted:!0,size:0,children:"Overlay connection status"}),e(u,{size:1,children:C})]})}),"connected"!==m&&e(i,{padding:3,radius:2,tone:"critical",children:t(s,{space:3,children:[e(h,{muted:!0,size:0,children:"Loader connection status"}),e(u,{size:1,children:m})]})})]})})}):null:e(qn,{initial:"initial",animate:"animate",exit:"exit",variants:er,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:t(o,{style:{...Yn[M]},justify:"center",align:"center",direction:"column",gap:4,children:[e(P,{muted:!0}),e(c,{muted:!0,size:1,children:"Loading…"})]})}):e(qn,{initial:"initial",animate:"animate",exit:"exit",variants:er,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:G?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:G?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:t(o,{style:{...Yn[M]},justify:"center",align:"center",direction:"column",gap:4,children:[G&&e(p,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),e(i,{radius:2,tone:G?"caution":"inherit",padding:4,shadow:1,children:t(o,{justify:"center",align:"center",direction:"column",gap:4,children:[e(P,{muted:!0}),e(c,{muted:!0,size:1,children:G?e(n,{children:"Unable to connect, check the browser console for more information."}):"Connecting…"})]})}),G&&e(p,{fontSize:1,tone:"critical",onClick:re,text:"Continue anyway"})]})})}),e($n,{ref:a,style:{pointerEvents:Y&&!ie?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:f.toString(),initial:["background"],variants:nr,animate:[!B&&!Y||ie?"active":"background",X?"reloading":"idle",M,ae&&!ie?"timedOut":""],onLoad:le})]})})]})})})),Yn={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},er={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},tr={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},nr={desktop:{...Yn.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...Yn.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function rr(r){const{initialUrl:i,openPopup:o,previewLocationOrigin:a,previewLocationRoute:s}=r,c=I((e=>{e.preventDefault(),o(e.currentTarget.href)}),[o]);return t(n,{children:[e(ir,{initialUrl:i,previewLocationOrigin:a,previewLocationRoute:s}),e(k,{icon:Se,text:"Open preview",as:"a",href:"".concat(a).concat(s),onClick:c,rel:"opener",target:"_blank"})]})}function ir(t){const{initialUrl:n,previewLocationOrigin:r,previewLocationRoute:i}=t,{push:o}=E(),a=B({apiVersion:pe}),s=q(),[c,l]=j(!1);return e(k,{disabled:c,onClick:()=>{if(!(null==navigator?void 0:navigator.clipboard))return o({closable:!0,status:"error",title:"Clipboard not supported"}),!1;let e;l(!0);let t="".concat(r).concat(i);const c=()=>{o({id:e,closable:!0,status:"success",title:"The URL is copied to the clipboard"}),l(!1)},d=e=>{o({closable:!0,status:"error",title:"Copy failed",description:e.message||e.toString()}),l(!1)};if(Re(n)&&"undefined"!=typeof ClipboardItem){const r="text/plain",l=new ClipboardItem({[r]:(async()=>{e=o({closable:!0,title:"Copying URL to clipboard…"});const c=await je(a,"@sanity/presentation","undefined"==typeof window?"":location.href,null==s?void 0:s.id),l=Le(n,c.secret,i);return t=l.toString(),new Blob([t],{type:r})})()});navigator.clipboard.write([l]).then(c).catch(d)}else navigator.clipboard.writeText(t).then(c).catch(d)},text:"Copy link",icon:ze})}let or=!1;function ar(e){var t;if(void 0===e)return;const n=null==(t=decodeURIComponent(e))?void 0:t.split(".");return"drafts"===n[0]&&n.shift(),n.join(".")}function sr(e){if(void 0!==e)return r.toString(function(e){const t=[];for(const n of e.split(".")){const e=Ye.exec(n);if(e){t.push(e[1],Number(e[2]));continue}const r=et.exec(n);if(r){t.push(r[1],[Number(r[2]),Number(r[3])]);continue}const i=tt.exec(n);i?t.push(i[1],{_key:i[2]}):t.push(n)}return t}(decodeURIComponent(e)))}function cr(e){return Object.fromEntries(Object.entries(e).filter((([,e])=>void 0!==e&&""!==e&&null!==e)))}function lr({initialPreviewUrl:e,routerNavigate:t,routerState:n,routerSearchParams:r,frameStateRef:i}){const o=O((()=>{const{id:t,path:i,type:o}={id:ar((a=n).id),path:sr(a.path),type:a.type};var a;return{id:t,type:o,path:i,preview:r.preview||"".concat(e.pathname).concat(e.search),perspective:r.perspective,viewport:r.viewport,inspect:r.inspect,rev:r.rev,since:r.since,template:r.template,templateParams:r.templateParams,view:r.view,pathKey:r.pathKey,instruction:r.instruction,comment:r.comment}}),[n,r,e]),a=O((()=>cr({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,templateParams:o.templateParams,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment})),[o.comment,o.inspect,o.instruction,o.path,o.pathKey,o.rev,o.since,o.template,o.templateParams,o.view]),s=U(n);D((()=>{s.current=n}),[n]);return{deskParams:a,navigate:O((()=>Ft(((e,n={},r)=>{const{_searchParams:o,...a}=s.current,c=(o||[]).reduce(((e,[t,n])=>(e[t]=n,e)),{}),l=cr({...a,...e}),d=cr({...c,...n});a.id!==l.id&&(delete d.template,delete d.templateParams),l._searchParams=Object.entries(d).reduce(((e,[t,n])=>[...e,[t,n]]),[]);const p=null!=r?r:d.preview===i.current.url;t(l,{replace:p})}),50)),[t,i]),params:o}}function dr(e,t,n){var r,i;const o=B({apiVersion:pe}),a=F(),s=(null==(r=null==a?void 0:a.activeWorkspace)?void 0:r.basePath)||"/",c=(null==(i=null==a?void 0:a.activeWorkspace)?void 0:i.name)||"default",l=function(e,t,n){const r=q();return O((()=>["@sanity/presentation",t,n,e,null==r?void 0:r.id,pr]),[t,null==r?void 0:r.id,e,n])}(t,s,c),d=function(e,t){const n=B({apiVersion:pe}),r=q(),[i,o]=j(""),a=e?Me((async()=>await je(n,"@sanity/presentation","undefined"==typeof window?"":location.href,null==r?void 0:r.id)),[...t,i]):null;return D((()=>{if(!a)return;const e=setTimeout((()=>{W((()=>o(a.expiresAt.toString())))}),a.expiresAt.getTime()-Date.now());return()=>clearTimeout(e)}),[a]),(null==a?void 0:a.secret)||null}("object"==typeof e||"function"==typeof e,l);return Me((async()=>{if("string"==typeof e){const t=new URL(e,location.origin);let r=t;try{if(n){const e=new URL(n,t);e.origin===t.origin&&(r=e)}else if(document.referrer){const e=new URL(document.referrer);e.origin===t.origin&&(r=e)}}catch{}return location.origin!==r.origin||!r.pathname.startsWith("".concat(s,"/"))&&r.pathname!==s?r:t}const t="object"==typeof e?_e(e):e,r=await t({client:o,previewUrlSecret:d,previewSearchParam:n,referrer:"undefined"==typeof document?null:document.referrer,studioBasePath:s});return new URL(r,location.origin)}),[...l,d])}const pr=Symbol();var ur,hr=Object.freeze,fr=Object.defineProperty;const mr=N((()=>import("./LoaderQueries-Dl1GMq7F.js"))),vr=N((()=>import("./RevalidateTags-NGPnmH_q.js"))),gr=ae(o)(ur||(ur=((e,t)=>hr(fr(e,"raw",{value:hr(t||e.slice())})))(["\n  overflow-x: auto;\n"])));function yr(i){var a;const{previewUrl:s,components:c,unstable_emitExperimentalRevalidateTagsLoaderEvent:l}=null!=(a=i.tool.options)?a:{},d=i.tool.name||me,{unstable_navigator:p}=c||{},{navigate:u,state:h}=Z(),f=$(Object.fromEntries(h._searchParams||[])),m=dr(s||"/",d,f.preview||null),[v]=j((()=>{var e;const t=null==(e=i.tool.options)?void 0:e.devMode;return"function"==typeof t?t():"boolean"==typeof t?t:"undefined"!=typeof window&&"localhost"===window.location.hostname})),g=O((()=>m.origin),[m.origin]),y=U(null),[w,b]=j(),[x,k]=j({}),P=U({title:void 0,url:void 0}),{params:E,deskParams:z,navigate:C}=lr({initialPreviewUrl:m,routerNavigate:u,routerState:h,routerSearchParams:f,frameStateRef:P}),[R,L]=_(Dn,{perspective:E.perspective,viewport:E.viewport},Wn),[T,A]=function(e){if("published"!==e&&"previewDrafts"!==e)throw new Error("Invalid perspective: ".concat(e));const[t,n]=j({}),[r,i]=j({}),o=I(((e,t)=>{const r=t.filter((e=>"_projectId"in e&&e._projectId?(or||(console.warn("Cross dataset references are not supported yet, ignoring source document",e),or=!0),!1):e));("published"===e?n:i)((e=>{const t={};for(const e of r)t[e._id]=e;return We(e,t)?e:t}))}),[]);return[O((()=>"published"===e?[...Object.values(t)]:[...Object.values(r)]),[e,r,t]),o]}(R.perspective),N=G(),V=J();D((()=>{R.perspective===E.perspective&&R.viewport===E.viewport||C({},{perspective:"previewDrafts"===R.perspective?void 0:R.perspective,viewport:"desktop"===R.viewport?void 0:R.viewport})}),[E.perspective,R.perspective,C,R.viewport,E.viewport]);const[F,K]=j("connecting"),[B,q]=j("connecting"),[H,Q]=j("connecting"),[Y]=j((()=>new Set)),ee=I((e=>{const t=window.open(e,"_blank");t&&Y.add(t)}),[Y]);D((()=>{if(Y.size&&w)for(const e of Y)e&&"closed"in e&&!e.closed&&w.addSource(e)}),[w,Y,Y.size]),D((()=>{var e;const t=null==(e=y.current)?void 0:e.contentWindow;if(!t)return;const n=function(e){const{destroy:t,send:n}=Qe(e),r=new Set,i=new WeakMap,o=new Set;return{destroy:()=>{t();for(const e of o)e()},send:(e,t,o)=>{n(e,t,o);for(const n of r)n&&"closed"in n&&!n.closed&&i.has(n)&&i.get(n)(e,t,o)},addSource(t){if(r.has(t))return;if(!("closed"in t))throw console.warn("Source is unsupported",{source:t}),new Error("Source is unsupported");if(t.closed)throw new Error("Source is closed");const{send:n,destroy:a}=Qe({...e,target:t,connectTo:e.connectTo.map((e=>{const{onStatusUpdate:t,onEvent:n,...r}=e;return{...r,onEvent:n?(e,t)=>{if("preview-kit/documents"!==e&&"overlay/navigate"!==e&&"loader/documents"!==e)return n(e,t)}:void 0}}))});o.add(a),i.set(t,n),r.add(t)}}}({id:"presentation",target:t,targetOrigin:g,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:K,onEvent(e,t){if("overlay/focus"===e&&"id"in t)C({type:t.type,id:t.id,path:t.path});else if("overlay/navigate"===e){const{title:e,url:n}=t;P.current.url!==n&&C({},{preview:n}),P.current={title:e,url:n}}else"visual-editing/meta"===e?P.current.title=t.title:"overlay/toggle"===e&&L({type:jn,enabled:t.enabled})}},{id:"loaders",heartbeat:!0,onStatusUpdate:q,onEvent(e,t){if("loader/documents"===e&&t.projectId===N&&t.dataset===V)A(t.perspective,t.documents);else if("loader/query-listen"===e&&t.projectId===N&&t.dataset===V){if("number"==typeof t.heartbeat&&t.heartbeat<ue)throw new Error("Loader query listen heartbeat interval must be at least ".concat(ue,"ms"));k((e=>{var n,r,i;return{...e,[(r=t.query,i=t.params,"".concat(r,"-").concat("string"==typeof i?i:JSON.stringify(i)))]:{perspective:t.perspective,query:t.query,params:t.params,receivedAt:Date.now(),heartbeat:null!=(n=t.heartbeat)&&n}}}))}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:Q,onEvent(e,t){"preview-kit/documents"===e&&t.projectId===N&&t.dataset===V&&A(t.perspective,t.documents)}}]});return b(n),()=>{n.destroy(),b(void 0)}}),[V,N,A,C,g]),D((()=>{const e=setInterval((()=>W((()=>k((e=>{if(Object.keys(e).length<1)return e;const t=Date.now();if(!Object.values(e).some((e=>!1!==e.heartbeat&&t>e.receivedAt+e.heartbeat)))return e;const n={};for(const[r,i]of Object.entries(e))!1!==i.heartbeat&&t>i.receivedAt+i.heartbeat||(n[r]=i);return n}))))),ue);return()=>clearInterval(e)}),[]);const te=I((e=>{C({path:r.toString(e)},{},!0)}),[C]),ne=I((e=>{const t=new URL(e,m.origin),n=t.pathname+t.search;t.origin===m.origin&&n!==E.preview&&C({},{preview:n})}),[m,E,C]),re=I((e=>{C({},e)}),[C]);D((()=>{E.id&&E.path?null==w||w.send("overlays","presentation/focus",{id:E.id,path:E.path}):null==w||w.send("overlays","presentation/blur",void 0)}),[w,E.id,E.path]),D((()=>{P.current.url&&E.preview&&P.current.url!==E.preview&&(P.current.url=E.preview,"connected"!==F&&y.current?y.current.src="".concat(g).concat(E.preview):null==w||w.send("overlays","presentation/navigate",{url:E.preview,type:"replace"}))}),[w,F,g,E.preview]);const ie=I((()=>null==w?void 0:w.send("overlays","presentation/toggleOverlay",void 0)),[w]),[ae,se]=j(null);D((()=>{const e=e=>{rt(e)&&ie()},t=e=>{var t;rt(e)&&ie(),t=e,["mod","\\"].every((e=>nt[e]?t[nt[e]]:t.key===e.toUpperCase()))&&ie()};return window.addEventListener("keydown",t),window.addEventListener("keyup",e),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",e)}}),[ie]);const[ce,le]=j(null),[{navigatorEnabled:de,toggleNavigator:pe},ge]=cn({unstable_navigator:p}),ye=U(E.id);D((()=>{E.rev&&ye.current&&E.id!==ye.current&&C({},{rev:void 0}),ye.current=E.id}));const we=X(),be=I((({id:e,type:t,path:n})=>{if(P.current.url)return{title:P.current.title||P.current.url,name:"edit",params:{id:e,path:n,type:t,inspect:he,workspace:we.name,mode:fe,preview:E.preview}}}),[E.preview,we.name]);return t(n,{children:[e(pn,{deskParams:z,devMode:v,name:d,params:E,navigate:C,children:e(sn,{navigate:C,children:e(dn,{params:E,children:e(gr,{height:"fill",children:t(an,{children:[e(ge,{}),e(Ut,{id:"preview",minWidth:325,defaultSize:de?50:75,order:3,children:e(o,{direction:"column",flex:1,height:"fill",ref:le,children:e(S,{element:ce,children:e(Qn,{dispatch:L,initialUrl:m,loadersConnection:B,navigatorEnabled:de,onPathChange:ne,openPopup:ee,overlayEnabled:R.visualEditing.overlays.enabled,overlaysConnection:F,params:E,perspective:R.perspective,previewKitConnection:H,ref:y,targetOrigin:g,toggleNavigator:pe,toggleOverlay:ie,viewport:R.viewport})})})}),e(Vt,{order:4}),e(Ut,{id:"content",minWidth:325,order:5,children:e(ve,{documentId:E.id,setDisplayedDocument:se,children:e(oe,{getIntent:be,children:e(It,{refs:T,deskParams:z,documentId:E.id,documentType:E.type,onDeskParams:re,onFocusPath:te,previewUrl:E.preview})})})})]})})})})}),w&&e(M,{children:e(mr,{channel:w,liveQueries:x,perspective:R.perspective,liveDocument:ae,documentsOnPage:T})}),l&&w&&e(M,{children:e(vr,{channel:w})})]})}export{yr as default};//# sourceMappingURL=PresentationTool-Brzzh4yZ.js.map
